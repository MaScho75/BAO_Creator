<!DOCTYPE html>
<html lang="de"><head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="noindex" name="robots">
		<meta content="nofollow" name="robots">
		<meta content="no-cache" http-equiv="cache-control">
		<meta content="EPHK Schommer, Marcel, A 45/4, marcel.schommer@polizei.berlin.de" name="author">
		<meta content="(c)2025 - Polizei Berlin" name="copyright">
		<title>BAO Creator 2025</title>
		

<style type="text/css"> 
	
	
/* Schriften */

	body {
    	font-family:  arial;
		display: flex;
	}
	
	pre {
		white-space: pre-wrap;
		font-family: arial;
		margin: 0px;
	}
		
	p {
		font-size: 12px;
		margin: 0px;
		padding: 0px;
	}

	li {
		font-size: 12px;
		margin: 0px;
		padding: 0px;
	}

	p.digi {
		text-align: center;
		margin-top: -24px;
		margin-bottom: 15px;
		font-size: 12px;
		text-align: center;
	}


/* Seiten */
	
	#Seite {
	width: 1000px;
	height: 700px;
	padding: 0;
	z-index: 200;
	}

	#BAOFenster {
	visibility: hidden;
	padding: 10px;
	position: absolute;
	top: 0px;
	z-index: 250;
	}

	#Formular {
	border: solid black thin;
	background-color: rgb(207 220 229);
	visibility: hidden;
	padding: 20px;
	position: absolute;
	top: 10px;
	z-index: 300;
	}

	#Import {
	margin: 10px;
	border: solid black thin;
	background-color: rgb(194 159 99);
	visibility: hidden;
	padding: 20px;
	position: absolute;
	
	top: 10px;
	z-index: 400;
	}

	#InfoBox {
	width: 600px;
	height: 600px;	
	position: absolute;
	top: 10px;
	padding: 15px;
	overflow: auto;
	z-index: 1200;
	background-color: rgb(207, 220, 229);
	visibility: hidden;	
	}

	#Toolbox {
    width: 150px;
    margin: 10px;
    display: block;
    flex-wrap: wrap;
    align-content: flex-start;
    align-items: center;
	padding: 10px;
	z-index: 600;
	border: solid thin;
	background-color: rgba(250, 250, 250, 0.5);
	text-align: center;
	}

/* Toolboxelemente */

	.plus {
	font-size: 12px;
	width: 100%;
	height: 25px;
	margin: 2px;
	text-align: left;	
	border-width: 1px;	
    }

	.plus:hover {
	    background-color: rgba(100, 100, 100, 0.5);
	}
	
	#Schere {
	position: absolute;
	display: none;
	left: 65px;
	border: dotted thin green;
	top: 63px;
	text-align: center;
	font-size: 30px;
	margin: 0px;
	z-index: 500;
	}

	#Papierkorb {
	position: absolute;	
	display: none;
	left: 15px;
	border: dotted thin red;
	top: 63px;
	text-align: center;
	font-size: 30px;
	margin: 0px;
	z-index: 500;
	}

	#InfoBoxSchließenButton {
	font-size: 20px;
	font-weight: bold;
	}
	
/* unsortiert */

	#Digigruppe {
	height: 55px;
	}

    #Linien {
	position: absolute;
    width: 200%;
    height: 100%;
    top: 0px;
    left: -200px;
    }


	#LinienGB {
	position: absolute;
	display: block;
	width: 120%px;
	height: 500px;
	top: 0px;
	left: 0px;
	z-index: -100;
	}
	
	#LinieGB {
	position: absolute;
	left: 0px;
	top: 0px;
	height: 100%;
	width: 100%;
	}

	.KMEintrag {
	background-color: #f9f9f9;
	}

	.KMEintrag:hover {
	background-color: rgba(200, 200, 200, 0.888);
	}

	.contextMenu {
	display: none;
	position: absolute;
	background-color: #f9f9f9;
	border: 1px solid #ccc;
	padding: 8px;
	box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
	z-index: 500;
	}



	.EAFÜGr {
	border: 1px solid;
	border-bottom: none;
	padding: 5px;
	text-align: left;
	font-size: 12px;
	grid-row: 1 / 1;
	margin: 0px 5px;
	}

	.EAFÜGr:hover {
	background-color: rgba(200, 200, 200, 0.888);
	;
	}

	.EAEinzelA {
	border: 1px solid;
	padding: 5px;
	text-align: left;
	font-size: 12px;
	grid-row: 2 / 2;
	margin: 0px 5px;
	}

	.EAZeile {
	display: grid;
	grid-template-columns: repeat(6, minmax(auto, auto));
	grid-template-rows: repeat(3, auto);
	/*grid-gap: 15px;*/
	}

	.EADigi {
	grid-row: 3 / 3;
	text-align: center;
	}

	.EAKnöpfe {
	grid-row: 4 / 4;
	text-align: center;
	margin: 15px;
	}

	.EABlockÜberschrift {
	text-align: center;
	color: white;
	background-color: rgb(0, 34, 102);
	font-size: 14px;
	font-weight: bold;
	padding: 5px 5px;
	}

	.EABlockInhalt {
	text-align: center;
	font-size: 12px;
	padding: 0px 5px;
	}

	.Block {
	padding: 0px 5px;
	display: table-cell;
	position: relative;
	z-index: 260;
	}

	.Kasten {
	margin: 20px;
	border: solid rgb(0, 34, 102) thin;
	width: max-content;
	margin-left: auto;
	margin-right: auto;
	}

	.Kasten:hover {
	background-color: rgba(200, 200, 200, 0.888);
	}

	#BAOSchließen {
	position: absolute;
	left: 10px;
	top: 10px;
	}



	#BAOGrafik {
	z-index: 260;
	}

	#FEM {
	height: 50px;
	width: 100%;
	}

	#EAnlass {
	height: 50px;
	width: 300px;
	}

	#Kräfte {
	width: 100%;
	height: 50px;
	}

	#FüGrKräfte {
	width: 100%;
	height: 50px;
	}

	#SpalteEinzelaufträge {
	width: 220px;
	}

	#Einzelaufträge {
	width: 300px;
	height: 365px;
	}

	#UASMH {
	width: 250px;
	height: 443px;
	}

	.center {
	text-align: center;
	}

	.EAKnopf {
	width: 80%;
	margin: 5px;
	border: none;
	font-size: 12px;
	box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	border-radius: 3px;
	background-color: rgb(192, 0, 34);
	color: white;

	}

	#Dienststelle {
	font-size: 15px;
	font-weight: normal;
	text-align: left;
	margin: 0px;
	}

	#Überschrift {
	font-size: 20px;
	font-weight: bold;
	text-align: center;
	margin: 0px;
	}

	#Stand {
	text-align: right;
	font-size: 10px;
	vertical-align: top;
	}

	#kopf {
	display: flex;
	font-size: 12px;
	}

	#kopf:hover {
		background-color: rgba(200, 200, 200, 0.888);
	}

	.kopfteil {
	height: 100px;
	border: 1px solid;
	padding: 5px;
	}

	#Polizeiführer {
	margin: 0px 10px 0px 10px;
	width: 200px;
	}

	#Anlass {
	width: 400px;
	}

	#Führungsgruppe {
	width: 400px;
	}

	.digi {
	font-size: 12px;
	}

	#SMH {
	margin: 5px;
	font-size: 14px;
	font-weight: normal;
	text-align: left;
	}


	.menubutton {
	width: 100px;
	margin: 5px 10px;
	border: none;
	font-size: 12px;
	box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	border-radius: 3px;
	background-color: rgb(0 34 102);
	color: white;
	}

	.editorbutton {
	width: 200px;
	height: 40px;
	margin: 10px 0px;
	border: solid thin;
	}

	.Spalte1 {
	width: 110px;
	vertical-align: top;
	text-align: right;
	padding-right: 10px;
	}

	.Spalte2 {
	width: 220px;
	}

	input {
	width: 220px;
	font-family: courier new;
	}	
	
	.Button_Formular {
	    width: 200px;
        height: 40px;
        margin: 10px;
	}
	
/* nicht druckbare Elemente */
	@media print {
 		hr.nichtdrucken,
		#Toolbox
		{
        display: none;
    	}
	}	
		
	</style>
			
	</head>
	
	<body ea-data="[{&quot;ENr&quot;:1,&quot;UANr&quot;:[2,3,4],&quot;darüber&quot;:&quot;&quot;,&quot;EBezeichnung&quot;:&quot;PF 1&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EFührer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LFüGr&quot;:&quot;n.n.&quot;,&quot;FüGrRufname&quot;:&quot;n.n.&quot;,&quot;FüGrTelefon&quot;:&quot;n.n.&quot;,&quot;FüGrKräfte&quot;:&quot;n.n.&quot;,&quot;Kräfte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelaufträge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:2,&quot;UANr&quot;:[],&quot;darüber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 1&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EFührer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LFüGr&quot;:&quot;n.n.&quot;,&quot;FüGrRufname&quot;:&quot;n.n.&quot;,&quot;FüGrTelefon&quot;:&quot;n.n.&quot;,&quot;FüGrKräfte&quot;:&quot;n.n.&quot;,&quot;Kräfte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelaufträge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:3,&quot;UANr&quot;:[],&quot;darüber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 2&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EFührer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LFüGr&quot;:&quot;n.n.&quot;,&quot;FüGrRufname&quot;:&quot;n.n.&quot;,&quot;FüGrTelefon&quot;:&quot;n.n.&quot;,&quot;FüGrKräfte&quot;:&quot;n.n.&quot;,&quot;Kräfte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelaufträge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:4,&quot;UANr&quot;:[],&quot;darüber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 3&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EFührer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LFüGr&quot;:&quot;n.n.&quot;,&quot;FüGrRufname&quot;:&quot;n.n.&quot;,&quot;FüGrTelefon&quot;:&quot;n.n.&quot;,&quot;FüGrKräfte&quot;:&quot;n.n.&quot;,&quot;Kräfte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelaufträge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;}]">

	<div id="Gesamtansicht" style="display: flex; flex-direction: row;">
	
	<!---- Toolbox ---->
		<div id="Toolbox" style="visibility: visible; display: block;">
			<p><b>Toolbox</b></p>
			
			<button class="plus" id="NEU" onclick="neu();">neue Datei</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="Speichern" onclick="speichernhtml();">💾   speichern unter</button>
			<button class="plus" id="Export" onclick="exportjson();">Export</button>
			<button class="plus" id="Importieren" onclick="Import();">Import</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="Übersicht" onclick="Übersicht();" disabled="">Gesamtübersicht</button>
			<button class="plus" id="AA" onclick="Ansichten_aktualisieren();">Ansicht aktualisieren</button>
			<button class="plus" id="BAO_GB" onclick="BAO_GB();" disabled="">BAO / GB</button>
			<button class="plus" id="BAO2" onclick="BAO_öffnen2();">BAO des EA</button>
			<button class="plus" id="GB2" onclick="GB_öffnen2();">GB des EA</button>
			<button class="plus" id="Hoch" onclick="Höher_Stufen();" disabled="">übergeordneter EA</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="Stift" onclick="Editor();">✎ - EA beearbeiten </button>
			<button class="plus" id="addEA" onclick="EAplus();">+ EA</button>
			<button class="plus" id="addEinsatz" onclick="BAOplus();">+ Einsatz</button>
			<button class="plus" id="entlassen" onclick="EA_entlassen(EA_select);" disabled="">EA entlassen</button>
			<button class="plus" id="löschen" onclick="EA_löschen_StufeA();"><span style="color: red">X </span>- EA löschen</button>
			<button class="plus" id="links" onclick="shiftLeft();" disabled="">← EA verschieben</button>
			<button class="plus" id="rechts" onclick="shiftRight();" disabled="">→ EA verschieben</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="InfoBoxButton" onclick="InfoBox_öffnen();">Info/Hilfe</button>

			<button class="plus" id="DruckButton" onclick="drucken();">drucken</button>

		</div>
		
		<div id="zweiteSeite">	
		<!---- Grafischer Befehl ---->
			<div id="Seite" style="visibility: hidden;">
			<table width="100%">
				<tbody>
					<tr>
						<td id="Dienststelle">n.n.</td>
						<td id="Überschrift">
							Grafischer Befehl - VS-nfD - <span id="EDatum">n.n.</span> - <span id="EinsatzID">1 - Ausgewählt: 1</span></td>
						<td id="Stand">25-01-18 - 10-58-07</td>
					</tr>
				</tbody>
			</table>
			<div id="kopf" style="background-color: rgba(240, 210, 140, 0.886);">
				<div class="kopfteil" id="Anlass"><b>Anlass</b><br><pre>n.n.</pre></div>
				<div class="kopfteil" id="Polizeiführer"><b>Polizeiführer/in</b><br>n.n.<br>n.n.<br>n.n.</div>
				<div class="kopfteil" id="Führungsgruppe">
					<b>Führungsgruppe</b><br>
					<table style="width: 100%">
						<tbody>
							<tr>
								<td id="FüGr1" style="width: 50%" valign="TOP">n.n.<br>n.n.<br>n.n.<br><pre>n.n.</pre></td>
								<td id="FüGr2" style="width: 50%" valign="TOP">MZO:<br> n.n.<br>EZO:<br> n.n.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div id="Digigruppe">
	
				<svg id="LinienGB"><line x1="318.328125" y1="204" x2="318.328125" y2="174" stroke="black"></line><line x1="554.984375" y1="204" x2="554.984375" y2="174" stroke="black"></line><line x1="791.6484375" y1="204" x2="791.6484375" y2="174" stroke="black"></line><line x1="318.328125" y1="174" x2="791.6484375" y2="174" stroke="black"></line></svg>
				<svg height="46" style="background-color: white; margin-left: 427px;" width="140px"> 
					<path d="M20,5 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: white"></path> 
					<text class="digi" style="font-weight: bold;" x="38" y="20">Digigruppe</text> 
				</svg>
				<p class="digi" id="DGruppe">n.n.</p>
			</div>
			
			<div id="Einsatzabschnitte"><div class="EAZeile"><div class="EAFÜGr" id="Einsatzabschnitt2"><p style="text-align: center"><b>(2) EA 1</b></p><hr><p>Führer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kräfte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelaufträge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p><div class="EAFÜGr" id="Einsatzabschnitt3"><p style="text-align: center"><b>(3) EA 2</b></p><hr><p>Führer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kräfte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelaufträge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p><div class="EAFÜGr" id="Einsatzabschnitt4"><p style="text-align: center"><b>(4) EA 3</b></p><hr><p>Führer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kräfte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelaufträge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p></div></div>
			<hr class="nichtdrucken" style="margin-top: 15px">
			<p style="margin: 5px; font-size: 20px; text-align: left;">
				<b>Sonstigen Maßnahnen und Hinweise</b></p>
			<div id="SMH"><pre>n.n.</pre></div>
			</div>
		
		<!---- Formular ---->
			<div id="Formular" style="visibility: hidden;">
			<form name="EAEingabe">
				<table>
					<tbody>
						<tr valign="top">
							<td style="padding: 10px; width: 350px;">
								<table>
									<tbody>
										<tr id="SpalteEBezeichnung">
											<td class="Spalte1">
												<label for="EBezeichnung">Bezeichnung</label></td>
											<td class="Spalte2">
												<input id="EBezeichnung" name="EBezeichnung"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDatum">Einsatzdatum</label></td>
											<td class="Spalte2">
												<input id="EiDatum" name="EDatum"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EFührer">Führer/in</label></td>
											<td class="Spalte2">
												<input id="EFührer" name="EFührer"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDst">Dienststelle</label></td>
											<td class="Spalte2">
												<input id="EDst" name="EDst"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EFRufname">Rufname</label></td>
											<td class="Spalte2">
												<input id="EFRufname" name="EFRufname"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EFTelefon">Telefon</label></td>
											<td class="Spalte2">
												<input id="EFTelefon" name="EFTelefon"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="LFüGr">LFüGr</label></td>
											<td class="Spalte2">
												<input id="LFüGr" name="LFüGr"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="FüGrRufname">FüGr-Rufname</label></td>
											<td class="Spalte2">
												<input id="FüGrRufname" name="FüGrRufname"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="FüGrTelefon">FüGr-Telefon</label></td>
											<td class="Spalte2">
												<input id="FüGrTelefon" name="FüGrTelefon"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="FüGrKräfte">FüGr-Kräfte</label></td>
											<td class="Spalte2">
												<span id="FeldFüGrKräfte" name="FeldFüGrKräfte"><textarea id="FüGrKräfte">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="Kräfte">Kräfte</label></td>
											<td class="Spalte2">
												<span id="FeldKräfte" name="FeldKräfte"><textarea id="Kräfte">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="MZMO">MZO</label></td>
											<td class="Spalte2">
												<input id="MZMO" name="MZMOA"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EZEO">EZO</label></td>
											<td class="Spalte2">
												<input id="EZEO" name="EZEO"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="FEM">FEM</label></td>
											<td class="Spalte2">
												<span id="FeldFEM" name="FeldFEM"><textarea id="FEM">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDigi">Digi</label></td>
											<td class="Spalte2">
												<input id="EDigi" name="EDigi"></td>
										</tr>
									</tbody>
								</table>
							</td>
						<!-- Spalte 2 -->	
							<td id="SpalteEinzelaufträge" style="padding: 10px; width: 300px;" valign="top">
								
								<label for="EAnlass">Anlass</label><br>
								<span id="FeldEAnlass" name="FeldEAnlass"><textarea id="EAnlass">n.n.</textarea></span>

								<label for="Einzelaufträge">Einzelaufträge</label><br>
								<span id="FeldEinzelaufträge" name="FeldEinzelaufträge"><textarea id="Einzelaufträge">n.n.</textarea></span>

							</td>

						<!-- Spalte 3 -->		
							<td id="SpalteSMH" style="padding: 10px; width: 200px;" valign="top">
								
								<label for="UASMH">sonstige Maßnahmen und Hinweise</label><br>
								<span id="FeldUASMH" name="FeldUASMH"><textarea id="UASMH">n.n.</textarea></span></td>
								
							
						</tr>
					</tbody>
				</table>
			</form>
			<button class="Button_Formular" id="übertragen" onclick="ESpeichern();">Übertragen</button><button class="Button_Formular" id="schließen" onclick="Schließen();">ohne speichern schließen</button><br>
			<!--Kontrollfelder-->
			
			<p style="font-family: Courier New; font-size: 10px; ">
				EANr:<span id="KonEANr">4</span>- UANr: <span id="KonUANr"></span></p>
			</div>
		
		<!---- Import ---->
		<div id="Import" style="visibility: hidden;">
			<h1>BAO importieren</h1>
			<p>
				<input id="fileInput" type="file"><button class="" onclick="importJSON()" style="width: 200px;">Laden</button><button class="plus" id="hoch" onclick="document.getElementById('Import').style.visibility = 'hidden';" style="width: 200px;">Schließen</button></p>
		</div>
		
		<!---- BAO ---->
			<div id="BAOFenster" style="visibility: visible;">
		    	<h1 style="text-align: center; margin: 0; margin-left: 200px;">
			    	BAO</h1>
				<p id="BAO_Anlass"><b>*** GESAMTÜBERSICHT ***</b></p>
		    	
				<div id="Linie">
		    			<svg id="Linien"><path d="M 353.046875,193v 20 " stroke="black"></path><line x1="261.015625" y1="213" x2="445.078125" y2="213" stroke="black"></line><path d="M 261.015625,233v -20 " stroke="black"></path><path d="M 353.046875,233v -20 " stroke="black"></path><path d="M 445.078125,233v -20 " stroke="black"></path></svg>
    			</div>

				<div id="BAOGrafik"><div class="Block"><div id="Block1" class="Kasten" style="background-color: rgba(240, 210, 140, 0.886);"><p id="EABÜ1" class="EABlockÜberschrift">PF 1</p><p class="EABlockInhalt">ENr: 1</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: 2,3,4</p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EFührer: n.n.</p><p class="EABlockInhalt">Kräfte: n.n.<br></p></div><div class="Block"><div id="Block2" class="Kasten"><p id="EABÜ2" class="EABlockÜberschrift">EA 1</p><p class="EABlockInhalt">ENr: 2</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EFührer: n.n.</p><p class="EABlockInhalt">Kräfte: n.n.<br></p></div></div><div class="Block"><div id="Block3" class="Kasten"><p id="EABÜ3" class="EABlockÜberschrift">EA 2</p><p class="EABlockInhalt">ENr: 3</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EFührer: n.n.</p><p class="EABlockInhalt">Kräfte: n.n.<br></p></div></div><div class="Block"><div id="Block4" class="Kasten"><p id="EABÜ4" class="EABlockÜberschrift">EA 3</p><p class="EABlockInhalt">ENr: 4</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EFührer: n.n.</p><p class="EABlockInhalt">Kräfte: n.n.<br></p></div></div></div></div>
			</div>
		
	    		
		<!---- Infobox ---->
		<div id="InfoBox" style="visibility: hidden;">
			<p>Sehr geehrte Kollegin,<br>
				sehr geehrter Kollege,<br><br></p>
			<p>
				ich stelle Dir hier den <b>"BAO-Creator"</b> vor. Dabei handelt es sich um eine Möglichkeit, auf einfache Weise eine BAO und den dazugehörigen Grafischen Befehl in einer einzigen Datei zu erstellen, zu speichern und zu verschicken.</p>
			<p>
				Daraus ergeben sich vielfältige Möglichkeiten bei der Planung und Durchführung von Polizeieinsätzen. Die Möglichkeiten und die weitreichenden Vorteile zur Nutzung des BAO-Creators möchte ich euch hier stichpunktartig vorstellen:</p>
			<ul>
				<li>
					Erstellung und Präsentation von polizeilichen BAO und grafischen Befehlen</li>
				<li>
					nur eine einzige Datei - kein klassisches Programm oder eine App</li>
				<li>
					PDV 100 konform</li>
				<li>
					einfache und selbsterklärende Bedienung</li>
				<li>
					Darstellung und Erstellung von große BAO mit mehreren Ebenen (EA/UA/UUA/UUUA etc.)</li>
				<li>
					Darstellung von mehreren BAO gleichzeitig nebeneinander</li>
				<li>
					Umgliederung im laufenden Einsatz per "Drag and Drop" bei automatischer Anpassung der Grafischen Befehle</li>
				<li>
					keine Formatierungen von Texten oder grafischen Elementen</li>
				<li>
					Dokumentation von laufenden Einsätzen bei Umstrukturierungen der BAO</li>
				<li>
					Dokumentation der erteilten Einzelaufträgen im laufenden Einsatz</li>
				<li>
					Einsatz- und Unterabschnitte können ihre BAO/Untergliederungen und grafische Befehle einfügen</li>
				<li>
					browserbasierend: Plattform- und Betriebssystemunabhängig</li>
				<li>
					von auswertige Einheiten und andere Bundesländer unkompliziert nutzbar</li>
				<li>
					kaum Gefahr von Viren oder Malware</li>
			</ul>
			<p>
				<b>technische Hinweise:</b></p>
			<ul>
				<li>
					Bei dem Dateiformat handelt es sich um eine html-Datei. Internetseiten sind in diesem Format gespeichert. Damit ist sie Plattformunabhängig. Eine Installation ist nicht vorgesehen. Es wird lediglich ein Internetbrowser (Edge, Chrome, Firefox etc.) benötigt. Eine Internetverbindung ist nicht erforderlich. Sie kann auf jedem System mit einem Browser verwendet werden: PC, Tablet, Handy, TV-Geräte mit integrierter Browser-Software etc.</li>
				<li>
					Die Datei kann zentral abgelegt (Cloud, SharePoint/IntraPol, Netzwerklaufwerk) oder per Email verschickt oder auf einem USB-Speicherstick abgelegt und weitergegeben werden.</li>
				<li>
					Es wird kein gesonderte Software benötigt. Der Programmcode ist in JavaScript geschrieben und in der html- Datei selbst enthalten. Das Einbringen von Schadcode (Viren etc.) ist nicht möglich. Der Programm-Code ist für alle einsehbar, und Anpassungen in der Struktur oder dem Layout lassen sich bei entsprechendem Sachverstand und Programmkenntnissen selbst realisieren oder weiter entwickeln.</li>
				<li>
					Die Einsätze sind als einzelne Datensätze gespeichert und lassen sich in und aus anderen Anwendungen portieren, z.B. Excel, Word, PowerPoint) So können auch verschiedene BAO und Grafische Befehle zusammengeführt werden.</li>
				<li>
					Wenn die Datei an einen zentralen Ort gespeichert und zur Verfügung gestellt wird, habe Einsatzkräfte und EA/UA jederzeit die Möglichkeit, die aktuelle BAO und die aktuellen Einsatzaufträge für sich und benachbarte Kräfte einzusehen. Veränderungen und Anpassungen sind sofort sichtbar und sorgen für verbesserte Transparenz.</li>
				<li>
					Weiterentwicklungen/Update können einfach durch eine neue Datei ersetzt werden. Ein reguläres Update eines Programms ist nicht erforderlich.</li>
			</ul>
			<p>
				<b>Besonderheit:</b></p>
			<p>
				Die Speicherung der Datei ist aus Sicherheitsgründen wegen der Architektur der Internetbrowser nicht ohne weiteres möglich. In der Regel muss für jede Speicherung eine neue Datei angelegt werden. Dies erfolgt allerdings automatisch als Download und ist nicht aufwendig.<br><br></p>
			<p>
				<b>Ausblick</b> - folgende Erweiterungen sind mit dem vorhanden Programm bei Erweiterung des Programmcodes möglich:</p>
			<ul>
				<li>
					Einbindung in ein Datenbanksystem</li>
				<li>
					Einbindung in CMS (SharePoint/IntraPol)</li>
				<li>
					Kräfteverwaltung</li>
				<li>
					Einrichtung unterschiedlicher Benutzerrechter mit unterschiedlichen Ebenen</li>
				<li>
					Einbindung in EPSweb-Oberfläche oder eines seiner Folgeprojekte</li>
			</ul>
			<p>
				Ich würde mich freuen, wenn Dir mein Tool gefällt und es Dir bei Deiner Arbeit ein Hilfe ist.<br><br></p>
			<p>
				Mit freundlichen Grüßen</p>
			<p>
				<i>Marcel Schommer</i></p>
		</div>
    	</div>
    </div>


	<script>

		'use strict';
		
		// Daten aus dem Bodytag auslesen

		let EA_JSON = document.body.getAttribute('ea-data');
		let EA = JSON.parse(EA_JSON);
		let DsNr = EA[0].ENr; // LfdNr des Datensatzes zur Identifizierung
		let EABlöcke = ""; // Variable, in der die Einsatzabschnitt dargestellt werden.
		let AktuellEditDsNr; // Die Datensatznummer, die gerade editiert wird. 
		let SKnopfx = [];
		let knopfname = [];
		let Zeile = [];
		let UA = false;
		let Gesamtübersicht = true; // Wir der gesamte Einsatz oder nur ein EA dargestellt?
		let DsNr_ist_Einsatz = true; 
		
		let EA_select = DsNr ; //Zeigt an, welcher EA für weitere Atkionen ausgewählt ist. 

		let Blockfarbe = "rgba(240, 210, 140, 0.888)";
		
		let Text_BAO_Anlass;

        // Datum der letzten Dateiänderung darstellen
		let letzteÄnderung = document.lastModified; 
		let letzteÄnderung2 = letzteÄnderung.slice(8, 10) + "-";
		letzteÄnderung2 += letzteÄnderung.slice(0, 2) + "-";
		letzteÄnderung2 += letzteÄnderung.slice(3, 5) + " - ";
		letzteÄnderung2 += letzteÄnderung.slice(11, 13) + "-";
		letzteÄnderung2 += letzteÄnderung.slice(14, 16) + "-";
		letzteÄnderung2 += letzteÄnderung.slice(17);
		document.getElementById("Stand").innerHTML = letzteÄnderung2;

		Ansichten_aktualisieren();
		
		BAO_öffnen();

		//GB_öffnen();

// Ende des regulären Programmablaufes...	

// *************  ausgelagerte Funktionen


// Grafischer Befehl 

		function Einsatzkopf() {

			window.moveTo(0, 0);

			let aEA = EA.find(elem => elem.ENr === DsNr);

			let PF = "<b>Polizeiführer/in</b><br>" + aEA["EFührer"] + "<br>" + aEA["EFRufname"] + "<br>" + aEA["EFTelefon"];
			let FüGr1 = aEA["LFüGr"] + "<br>" + aEA["EFRufname"] + "<br>" + aEA["FüGrTelefon"] + "<br><pre>" + aEA["FüGrKräfte"] + "</pre>";
			let FüGr2 = "MZO:<br>&ensp;" + aEA["MZMO"] + "<br>EZO:<br>&ensp;" + aEA["EZEO"];
			let Anlass = "<b>Anlass</b><br><pre>" + aEA["EAnlass"] + "</pre>";

			document.getElementById("EinsatzID").innerHTML = DsNr + " - Ausgewählt: " + EA_select ; // Einsatznummer in der Überschrift darstellen
			document.getElementById("Anlass").innerHTML = Anlass;
			document.getElementById("EDatum").innerHTML = aEA.EDatum;
			document.getElementById("Polizeiführer").innerHTML = PF;
			document.getElementById("FüGr1").innerHTML = FüGr1;
			document.getElementById("FüGr2").innerHTML = FüGr2;
			document.getElementById("DGruppe").innerHTML = aEA.EDigi;
			document.getElementById("Dienststelle").innerHTML = aEA.EDst;
			document.getElementById("SMH").innerHTML = "<pre>" + aEA.SMH + "</pre>";

			//Kopf rot markieren

			const markierterKopf = document.getElementById("kopf");

			if (DsNr === EA_select) {markierterKopf.style.backgroundColor = Blockfarbe;}
			else {markierterKopf.style.backgroundColor = '';}	
		
			markierterKopf.addEventListener('click', function() {
				EA_select = DsNr;
				Ansichten_aktualisieren();
				
			});
			
		}


		function Einsatzabschnitte() {

			let aEA = EA.find(elem => elem.ENr === DsNr); //aktueller Einsatz

			let AnzahlEA = aEA["UANr"].length;

			if (AnzahlEA > 0) {
				switch (true) {
					case AnzahlEA < 7: Zeile[1] = 6; Zeile[2] = 0; Zeile[3] = 0; break;
					case AnzahlEA == 7: Zeile[1] = 4; Zeile[2] = 3; Zeile[3] = 0; break;
					case AnzahlEA == 8: Zeile[1] = 4; Zeile[2] = 4; Zeile[3] = 0; break;
					case AnzahlEA == 9: Zeile[1] = 5; Zeile[2] = 4; Zeile[3] = 0; break;
					case AnzahlEA == 10: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 0; break;
					case AnzahlEA == 11: Zeile[1] = 6; Zeile[2] = 5; Zeile[3] = 0; break;
					case AnzahlEA == 12: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 0; break;
					case AnzahlEA == 13: Zeile[1] = 5; Zeile[2] = 4; Zeile[3] = 4; break;
					case AnzahlEA == 14: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 4; break;
					case AnzahlEA == 15: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 5; break;
					case AnzahlEA == 16: Zeile[1] = 6; Zeile[2] = 5; Zeile[3] = 5; break;
					case AnzahlEA == 17: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 5; break;
					case AnzahlEA == 18: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 6; break;
				}

				EABlöcke = "";

				EABlöcke += "<div class='EAZeile'>";

				let s = 0;

				let BlockLinie = [];

				for (let x of aEA["UANr"]) {
					s++;
					if (s <= Zeile[1]) { BlockLinie.push(x); }
					if (s == Zeile[1] + 1) EABlöcke += "</div><hr class='nichtdrucken' style='margin-top: 15px'><div class='EAZeile'>";	// Ende Zeile 1
					if (s == Zeile[1] + Zeile[2] + 1) EABlöcke += "</div><hr class='nichtdrucken' style='margin-top: 15px'><div class='EAZeile'>"; // Ende Zeile 2
					let a6EA = EA.find(elem => elem.ENr === x);

					Block(x); //Block erstellen
				}

				EABlöcke += "</div>"; // Schluss der Zeile 1,2 oder 3

				document.getElementById("Einsatzabschnitte").innerHTML = EABlöcke; //html Datei erstellen
				
				//Beim Klicken eines EA den EA Auswählen und farblich markieren
				
				for (let x of aEA["UANr"]) {

					const markierterEA = document.getElementById("Einsatzabschnitt" + x);

					if (x === EA_select) {markierterEA.style.backgroundColor = Blockfarbe;}//färbt den EA nach dem Klick

					markierterEA.addEventListener('click', function() {
						EA_select = x;
						Ansichten_aktualisieren();
					})
				
				}
		

				//Linien für den GB zeichnen

				let GBLinie = "";

				let EAElement;

				let korrextX = window.scrollX || window.pageXOffset; // horizontale Scrollposition
				let korrextY = window.scrollY || window.pageYOffset; // vertikale Scrollposition

				for (let StricheBG of BlockLinie) {
					EAElement = "Einsatzabschnitt" + StricheBG;

					let EAObjekt1 = document.getElementById(EAElement);
					let EAObjekt2 = EAObjekt1.getBoundingClientRect();

					GBLinie += "<line x1='";
					GBLinie += EAObjekt2.left + ((EAObjekt2.right - EAObjekt2.left) / 2) + korrextX;
					GBLinie += "' y1='";
					GBLinie += EAObjekt2.top + korrextY;
					GBLinie += "' x2='";
					GBLinie += EAObjekt2.left + ((EAObjekt2.right - EAObjekt2.left) / 2) + korrextX;
					GBLinie += "' y2='";
					GBLinie += EAObjekt2.top - 30 + korrextY;
					GBLinie += "' stroke='black'/>";
				}

				let StricheBG2 = BlockLinie[0]
				EAElement = "Einsatzabschnitt" + StricheBG2;
				let EAObjekt3 = document.getElementById(EAElement);
				let EAObjekt4 = EAObjekt3.getBoundingClientRect();
				let StricheBG3 = BlockLinie[(BlockLinie.length - 1)];
				EAElement = "Einsatzabschnitt" + StricheBG3;
				let EAObjekt5 = document.getElementById(EAElement);
				let EAObjekt6 = EAObjekt5.getBoundingClientRect();

				GBLinie += "<line x1='";
				GBLinie += EAObjekt4.left + ((EAObjekt4.right - EAObjekt4.left) / 2) + korrextX;
				GBLinie += "' y1='";
				GBLinie += EAObjekt4.top - 30 + korrextY;
				GBLinie += "' x2='";
				GBLinie += EAObjekt6.left + ((EAObjekt6.right - EAObjekt6.left) / 2) + korrextX;
				GBLinie += "' y2='";
				GBLinie += EAObjekt6.top - 30 + korrextY;
				GBLinie += "' stroke='black'/>";

				document.getElementById("LinienGB").innerHTML = GBLinie;

			} else {
				document.getElementById("Einsatzabschnitte").innerHTML = "<h1 style='text-align: center'>Keine EA vorhanden!<br></h1>";
				document.getElementById("LinienGB").innerHTML = "";
			}

		}


		function Block(EABlock) {

			let a2EA = EA.find(elem => elem.ENr === EABlock);

			EABlöcke += "<div class='EAFÜGr' id='Einsatzabschnitt" + a2EA["ENr"] + "'><p style='text-align: center'><b>(" + a2EA["ENr"] + ") ";
			EABlöcke += a2EA["EBezeichnung"] + "</b></p>";
			EABlöcke += "<hr><p>Führer: " + a2EA["EFührer"] + "</p>";
			EABlöcke += "<hr><p>Telefon: " + a2EA["EFTelefon"] + " / " + a2EA["FüGrTelefon"] + "</p>";
			EABlöcke += "<hr><p>Rufname: " + a2EA["EFRufname"] + " / " + a2EA["FüGrRufname"] + "</p>";
			EABlöcke += "<hr><p>Kräfte: <pre>" + a2EA["Kräfte"] + "</pre></p>";
			EABlöcke += "<hr><p>MZO: " + a2EA["MZMO"] + "</p>";
			EABlöcke += "<hr><p>EZO: " + a2EA["EZEO"] + "</p>";
			EABlöcke += "</div>";

			EABlöcke += "<div class='EAEinzelA'><b>Einzelaufträge:</b><br><pre>" + a2EA["Einzelaufträge"] + "</pre></p>";
			EABlöcke += "</div>";

			EABlöcke += "<p class='EADigi'><svg style='margin-bottom: -26px' width='140px' height='55'>";
			EABlöcke += "<text class='digi' x='38' y='25' style='font-weight: bold;'>Digigruppe</text>";
			EABlöcke += "<path d='M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z' stroke='black' style='fill: none'></path></svg>";
			EABlöcke += "<br><span>" + a2EA["EDigi"] + "</span></p>";
		}


//BAO		

		function BAO(BAO_gesamt) { //BAO_gesamt kann die werte true und false haben. Bei true werden alle Einsäzte angezeigt, bei false nur ein einzelner Einsatz oder Einsatzabschnitte.
            
            //Einsatzanlass nur Darstellen, wenn keine Gesamtübersicht ausgewählt ist. 
            if(!Gesamtübersicht) {
                for (let V_Anlass of EA) {
                    if (V_Anlass.ENr == DsNr) {
                        Text_BAO_Anlass = "<b>Anlass: </b>" + V_Anlass.EAnlass;
                    }
                }
            } else { Text_BAO_Anlass = "<b>*** GESAMTÜBERSICHT ***</b>";}
            
            document.getElementById("BAO_Anlass").innerHTML = Text_BAO_Anlass;//Einsatzanlass in der BAO mit und ohne Inhalt anzeigen. 
			
			var BAOStruktur = "";

			let darstellung = false;

			let korrektX = window.scrollX || window.pageXOffset; // horizontale Scrollposition
			let korrektY = window.scrollY || window.pageYOffset; // vertikale Scrollposition
			let BlID;
			let BAOLinien = "";
	
			if (BAO_gesamt) {

				for (let BAOBlock of EA) {
					if (BAOBlock.darüber == "") BAOStruktur += Blockdarstellung(BAOBlock);  // der erste Block wird nur dargestellt, wenn es keinen EA darüber gibt. Es handelt sich um einen eigenständigen Einsatz.
				}
			} else {
				for (let BAOBlock of EA) {
					if (BAOBlock.ENr == DsNr) BAOStruktur += Blockdarstellung(BAOBlock);
				}
			}

			document.getElementById("BAOGrafik").innerHTML =  BAOStruktur;

			//Blockmarkierung und selektion
			for (let BlockMark of EA) {
												
				const markierterBlock = document.getElementById("Block" + BlockMark.ENr);

				if (BlockMark.ENr === EA_select) {markierterBlock.style.backgroundColor = Blockfarbe;}//färbt den Block rot nach dem Klick
			
				if (markierterBlock) { //Fehlermeldung vermeiden, wenn der Block nicht existriert
				    markierterBlock.addEventListener('click', function() {
						EA_select = BlockMark.ENr;
						Ansichten_aktualisieren();
					});
				}
			}


			let Durchlauf = 0; // Das erste Kästchen darf kein Strich oben haben... 

	

			for (let Striche of EA) {

				BlID = "Block" + Striche.ENr;

				let meinDiv = document.getElementById(BlID); //  die aktuellen Koordinaten des Div-Elements zu ermitteln

				

				if (meinDiv) {  //nur wenn der EA existriert wird der folgende Code ausgeführt

					let rect = meinDiv.getBoundingClientRect(); //|| "kein Objekt"; // DOMRect-Objekt abrufen

					let mitteX = (rect.right - rect.left) / 2 + rect.left;
					let obenP = (mitteX + korrektX ) + "," + (rect.top + korrektY);
					let untenP = (mitteX + korrektX ) + "," + (rect.bottom + korrektY);

					//Linie sektrecht oben:
					++Durchlauf;
					if (Striche.darüber != "" && Durchlauf != 1) {
						BAOLinien += "<path d='M ";
						BAOLinien += obenP;
						BAOLinien += "v -20 ' stroke='black' />";
					}

					//Linie senkrecht unten:
					if (Striche.UANr != "") {
						BAOLinien += "<path d='M ";
						BAOLinien += untenP;
						BAOLinien += "v 20 ' stroke='black' />";

						//Querstrich 
						//von links ...
						let BlID1 = "Block" + Striche.UANr[0];
						let meinDiv1 = document.getElementById(BlID1);
						let rect1 = meinDiv1.getBoundingClientRect();
						let X1 = (rect1.right - rect1.left) / 2 + rect1.left;
						let Y1 = rect1.top;

						//nach recht
						let BlID2 = "Block" + Striche.UANr[Striche.UANr.length - 1];
						let meinDiv2 = document.getElementById(BlID2);
						let rect2 = meinDiv2.getBoundingClientRect();
						let X2 = (rect2.right - rect2.left) / 2 + rect2.left;

						BAOLinien += "<line x1='"; //Querstrich zeichnen
						BAOLinien += X1 + korrektX;
						BAOLinien += "' y1='";
						BAOLinien += Y1 - 20 + korrektY;
						BAOLinien += "' x2='";
						BAOLinien += X2 + korrektX;
						BAOLinien += "' y2='";
						BAOLinien += Y1 - 20 + korrektY;
						BAOLinien += "' stroke='black'/>";
					}
				}
			}

			document.getElementById("Linien").innerHTML = BAOLinien;

			//BAO - Blockaktionen	
			for (let BlockKlickObj of EA) {
				let KlickBlock = "Block" + BlockKlickObj.ENr;
				let DownBlock = "EABÜ" + BlockKlickObj.ENr;
				let BlockKlick = document.getElementById(KlickBlock);
				let BlockDown = document.getElementById(DownBlock);

				if (BlockKlick) {

					//Verschieben
					if (BAO_gesamt) { //nur verschiebar wenn es sich nicht um einen EA oder UA handelt
						BlockDown.addEventListener('mousedown', function () { verschieben(BlockKlickObj); }, false)
					}
				}
			}
		}


		function Blockdarstellung(Block,Nr) {

			let BAOStruktur2 = "";
			BAOStruktur2 += "<div class='Block'>";
			BAOStruktur2 += "<div id='Block" + Block.ENr + "' class='Kasten'>";
			BAOStruktur2 += "<p id='EABÜ" + Block.ENr + "' class='EABlockÜberschrift'>" + Block.EBezeichnung + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>ENr: " + Block.ENr + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EDatum: " + Block.EDatum + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>UANr: " + Block.UANr + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EDst: " + Block.EDst + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EFührer: " + Block.EFührer + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>Kräfte: " + Block.Kräfte + "<br></p>";
			BAOStruktur2 += "</div>";			// Kasten schließen

			//BAOStruktur2 += BAOKontextmenu(Block.ENr);

            let UBlockindex = -1;
            
			for (let UnterBlöcke of Block.UANr) {
			    UBlockindex = UBlockindex + 1;
				let UnterBlock = EA.find(elem => elem.ENr === UnterBlöcke);
				BAOStruktur2 += Blockdarstellung(UnterBlock, UBlockindex);
			}

			BAOStruktur2 += "</div>";	//Block schließen

			return BAOStruktur2;
		}


//BAO - Funktionen zum Verschieben von EA

		function verschieben(DoppelklickObj) { //Bock mit der Maus bewegen

			let BlockPosName = "Block" + DoppelklickObj.ENr;
			let BlockPosID = document.getElementById(BlockPosName);
			let BlockPosKo = BlockPosID.getBoundingClientRect();
			let DivMove = document.createElement('div');
			let DivMoveStyle = 'z-index: 2000; position: absolute; background: rgba(100, 100, 100, 0.5);';

			DivMoveStyle += 'width: ' + BlockPosKo.width + 'px;';
			DivMoveStyle += 'height: ' + BlockPosKo.height + 'px;';
			DivMoveStyle += 'left: ' + (BlockPosKo.left + window.scrollX) + 'px;';
			DivMoveStyle += 'top: ' + (BlockPosKo.top + window.scrollY) + 'px;';

			DivMove.setAttribute('style', DivMoveStyle);
			DivMove.setAttribute('id', 'MoveBlock');

			document.body.appendChild(DivMove);

			//Papierkorb nur anzeigen, wenn das Objekt gelöscht werden kann. Es darf nicht das letzte oberste Objekt sein.
			let PapierkorbAnzeigen = true;
			if (!DoppelklickObj.darüber) {

				let AnzahlEAdarüber = 0

				for (let EAD of EA) {
					if (!EAD.darüber) AnzahlEAdarüber++;
				}

				if (AnzahlEAdarüber == 1) PapierkorbAnzeigen = false;
			}

			DivMove.addEventListener('mousemove', function (e) {
				DivMove.style.left = e.clientX - DivMove.clientWidth / 2 + window.scrollX + 'px';
				DivMove.style.top = e.clientY - DivMove.clientHeight / 2 + window.scrollY + 'px';
			}, false);

			DivMove.addEventListener('mouseup', function () { MausAuf(DoppelklickObj.ENr) }, false);

		}


		function MausAuf(Start) {

			let DivMoveEnde = document.getElementById("MoveBlock");
			let PosX = DivMoveEnde.getBoundingClientRect().left + DivMoveEnde.clientWidth / 2 + window.scrollX;
			let PosY = DivMoveEnde.getBoundingClientRect().top + DivMoveEnde.clientHeight / 2 + window.scrollY;
			DivMoveEnde.remove(); //nachdem die Position bestimmt war, wird das Element gelöscht

			//Auf einem anderen Block abgelegt?
			for (let PosEA of EA) {

				if (AufElementAbgelegt(PosX, PosY, "Block" + PosEA.ENr)) {

					let Ziel = PosEA.ENr;

					let ZulässigVerschoben = EAaufUA(Start, Ziel);

					if (ZulässigVerschoben) {

						let verschiebeDS = EA[IndexENr(Start)];
						let darüberDSalt = EA[IndexENr(verschiebeDS.darüber)];
						let darüberDSneu = EA[IndexENr(Ziel)];

						//alte UANr. Bezug löschen
						if (darüberDSalt) {
							for (let i = 0; i < darüberDSalt.UANr.length; i++) {
								if (darüberDSalt.UANr[i] === Start) darüberDSalt.UANr.splice(i, 1);
							}
						}

						//neue UANr. Bezug setzen
						darüberDSneu.UANr.push(Start);

						//neue "darüber" ersetzen
						verschiebeDS.darüber = Ziel;

						Ansichten_aktualisieren()
					}
				}
			}
		}


		function EAaufUA(Start, Ziel) {
			if (Start == Ziel) { return false; }
			if (Ziel == EA[IndexENr(Start)].darüber) { return false; }
			return EAaufUA2(Start, Ziel);
		}


		function EAaufUA2(Start, Ziel) {
			for (let P2 of EA[IndexENr(Start)].UANr) {
				if (P2 == Ziel) { return false; }
				if (!EAaufUA2(P2, Ziel)) { return false; }
			}
			return true;
		}

	
		function AufElementAbgelegt(PosX, PosY, Element) {
			let PosObj = document.getElementById(Element);
			let BlockTop = PosObj.getBoundingClientRect().top + window.scrollY;
			let BlockBottom = PosObj.getBoundingClientRect().bottom + window.scrollY;
			let BlockLeft = PosObj.getBoundingClientRect().left + window.scrollX;
			let BlockRight = PosObj.getBoundingClientRect().right + window.scrollX;

			if (PosX > BlockLeft && PosX < BlockRight && PosY > BlockTop && PosY < BlockBottom) { return true; }

			return false;
		}



//Editor	
	
		function Editor() {
			
			Editor_öffnen();

			let a3EA = EA.find(elem => elem.ENr === EA_select);

			AktuellEditDsNr = EA_select;

			//Formularfelder füllen
			document.getElementById('KonEANr').innerHTML = a3EA["ENr"];
			document.getElementById('KonUANr').innerHTML = a3EA["UANr"];
			//document.getElementById('KonDarüber').innerHTML = a3EA["darüber"];
			document.getElementById('EDst').value = a3EA["EDst"];
			document.getElementById('EiDatum').value = a3EA.EDatum;
			document.getElementById('EBezeichnung').value = a3EA["EBezeichnung"];
			document.getElementById('FeldEAnlass').innerHTML = "<textarea id='EAnlass'>" + a3EA["EAnlass"] + "</textarea>";
			document.getElementById('EFührer').value = a3EA["EFührer"];
			document.getElementById('EFTelefon').value = a3EA["EFTelefon"];
			document.getElementById('EFRufname').value = a3EA["EFRufname"];
			document.getElementById('EDigi').value = a3EA["EDigi"];
			document.getElementById('LFüGr').value = a3EA["LFüGr"];
			document.getElementById('FüGrTelefon').value = a3EA["FüGrTelefon"];
			document.getElementById('FüGrRufname').value = a3EA["FüGrRufname"];
			document.getElementById('FeldFüGrKräfte').innerHTML = "<textarea id='FüGrKräfte'>" + a3EA["FüGrKräfte"] + "</textarea>";
			document.getElementById('FeldKräfte').innerHTML = "<textarea id='Kräfte'>" + a3EA["Kräfte"] + "</textarea>";
			document.getElementById('MZMO').value = a3EA["MZMO"];
			document.getElementById('EZEO').value = a3EA["EZEO"];
			document.getElementById('FeldFEM').innerHTML = "<textarea id='FEM'>" +  a3EA["FEM"] + "</textarea>";
			document.getElementById('FeldEinzelaufträge').innerHTML = "<textarea id='Einzelaufträge'>" + a3EA["Einzelaufträge"] + "</textarea>";
			document.getElementById('FeldUASMH').innerHTML = "<textarea id='UASMH'>" + a3EA['SMH'] + "</textarea>";
		}


		function Schließen() { //Schießen den Editorfensters
					document.getElementById("Formular").style.visibility = "hidden";
					document.getElementById("Toolbox").style.display = "block";
					Ansichten_aktualisieren();
				}

		
		function ESpeichern() {//Formulardatein in das Array übertragen

			let a4EA = EA.find(elem => elem.ENr === AktuellEditDsNr);

			//Daten auf das Array übertragen
			a4EA["EDst"] = document.getElementById('EDst').value;
			a4EA["EBezeichnung"] = document.getElementById('EBezeichnung').value;
			a4EA["EDatum"] = document.getElementById('EiDatum').value;
			a4EA["EAnlass"] = document.getElementById('EAnlass').value;
			a4EA["EFührer"] = document.getElementById('EFührer').value;
			a4EA["EFTelefon"] = document.getElementById('EFTelefon').value;
			a4EA["EFRufname"] = document.getElementById('EFRufname').value;
			a4EA["EDigi"] = document.getElementById('EDigi').value;
			a4EA["LFüGr"] = document.getElementById('LFüGr').value;
			a4EA["FüGrRufname"] = document.getElementById('FüGrRufname').value;
			a4EA["FüGrTelefon"] = document.getElementById('FüGrTelefon').value;
			a4EA["FüGrKräfte"] = document.getElementById('FüGrKräfte').value;
			a4EA["Kräfte"] = document.getElementById('Kräfte').value;
			a4EA["MZMO"] = document.getElementById('MZMO').value;
			a4EA["EZEO"] = document.getElementById('EZEO').value;
			//a4EA["FEM"] = document.getElementById('FEM').value;
			a4EA["Einzelaufträge"] = document.getElementById('Einzelaufträge').value;
			a4EA["SMH"] = document.getElementById('UASMH').value;

			document.getElementById("Formular").style.visibility = "hidden";
			document.getElementById("Toolbox").style.display = "block";
			Ansichten_aktualisieren();
}



//Ansichten ändern
		
		function Ansichten_aktualisieren() {
						
				BAO(Gesamtübersicht);
				Einsatzkopf();
				Einsatzabschnitte();
		
		}

		
		function BAO_GB() {
			let GB_offen = document.getElementById("Seite").style.visibility;
			let BAO_offen = document.getElementById("BAOFenster").style.visibility;

			if (GB_offen == "visible") {BAO_öffnen();}
			if (BAO_offen == "visible") {GB_öffnen();}

		}


		function Übersicht() {
			Gesamtübersicht = true;
			Ansichten_aktualisieren();
			BAO_öffnen();
		}


		function GB_öffnen2() {
            DsNr = EA_select;
            Ansichten_aktualisieren();
            GB_öffnen();
        }
        
        
		function GB_öffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "visible";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";
			
			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = false;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("Übersicht").disabled = false;
			document.getElementById("AA").disabled = false;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = false;
			document.getElementById("GB2").disabled = false;
			document.getElementById("Stift").disabled = false;
			document.getElementById("addEA").disabled = false;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = false;
			document.getElementById("löschen").disabled = false;
			document.getElementById("links").disabled = false;
			document.getElementById("rechts").disabled = false;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = false;
			
			if (DsNr == EA_select) {
				document.getElementById("entlassen").disabled = true;
				document.getElementById("löschen").disabled = true;
				document.getElementById("links").disabled = true;
				document.getElementById("rechts").disabled = true;
			}
		}


		function BAO_öffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "visible";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";
			
			document.getElementById("NEU").disabled = false;
			document.getElementById("Speichern").disabled = false;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("Übersicht").disabled = false;
			document.getElementById("AA").disabled = false;
			document.getElementById("BAO2").disabled = false;
			document.getElementById("GB2").disabled = false;
			document.getElementById("Stift").disabled = false;
			document.getElementById("addEA").disabled = false;
			document.getElementById("addEinsatz").disabled = false;
			document.getElementById("entlassen").disabled = false;
			document.getElementById("löschen").disabled = false;
			document.getElementById("links").disabled = false;
			document.getElementById("rechts").disabled = false;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = false;
			
			if (Gesamtübersicht) {
				document.getElementById("Export").disabled = false;
				document.getElementById("Importieren").disabled = false;
				document.getElementById("addEinsatz").disabled = false; 
				document.getElementById("Übersicht").disabled = true;
				document.getElementById("BAO_GB").disabled = true;
			} else {
				document.getElementById("Export").disabled = true;
				document.getElementById("Importieren").disabled = true;
				document.getElementById("addEinsatz").disabled = true; 
				document.getElementById("Übersicht").disabled = false;
				document.getElementById("BAO_GB").disabled = false;
			}

			if (DsNr_ist_Einsatz) {
				document.getElementById("Hoch").disabled = true;
				document.getElementById("links").disabled = true;
				document.getElementById("rechts").disabled = true;
			} else {
				document.getElementById("Hoch").disabled = false
				document.getElementById("links").disabled = false;
				document.getElementById("rechts").disabled = false;
			}

			Prüfung_Einsatz();
			
		}

		
		function BAO_öffnen2() {
            DsNr = EA_select;
            Gesamtübersicht = false;
            Ansichten_aktualisieren();
            BAO_öffnen();
        }


		function Editor_öffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "visible";
			document.getElementById("Toolbox").style.display = "none";
		}
		

		function Import() {
			document.getElementById("Import").style.visibility = "visible";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";

			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = true;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("Übersicht").disabled = true;
			document.getElementById("AA").disabled = true;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = true;
			document.getElementById("GB2").disabled = true;
			document.getElementById("Stift").disabled = true;
			document.getElementById("addEA").disabled = true;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = true;
			document.getElementById("löschen").disabled = true;
			document.getElementById("links").disabled = true;
			document.getElementById("rechts").disabled = true;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = true;
		}

		
		function InfoBox_öffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "visible";
			document.getElementById("Formular").style.visibility = "hidden";

			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = true;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("Übersicht").disabled = true;
			document.getElementById("AA").disabled = true;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = true;
			document.getElementById("GB2").disabled = true;
			document.getElementById("Stift").disabled = true;
			document.getElementById("addEA").disabled = true;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = true;
			document.getElementById("löschen").disabled = true;
			document.getElementById("links").disabled = true;
			document.getElementById("rechts").disabled = true;
			document.getElementById("InfoBoxButton").disabled = true;
			document.getElementById("DruckButton").disabled = false;
		}

		
		function UAöffnen(Aufklappen) {
			DsNr = Aufklappen;
			Ansichten_aktualisieren();
		}

		
		function drucken() {
			document.getElementById("Toolbox").style.display = "none";
			document.getElementById("Linien").style.left = "0px";
			Ansichten_aktualisieren();
			window.print();
			document.getElementById("Toolbox").style.display = "flex";
			document.getElementById("Linien").style.left = "-200px";
			Ansichten_aktualisieren();
		}

		
		function Prüfung_Einsatz() {
			let DS = EA.find(elem => elem.ENr === EA_select); //DS="Datensatz"
			if (!DS.darüber) {
			   
			    DsNr = EA_select;
			    document.getElementById("links").disabled = true;
			    document.getElementById("rechts").disabled = true;
			    document.getElementById("entlassen").disabled = true;
			  
			    }
            else {
               document.getElementById("links").disabled = false;
			   document.getElementById("rechts").disabled = false;
			   document.getElementById("entlassen").disabled = false;
			
            }
		}

		
//Datenfunktionen - Speichern - Laden - Verarbeiten

		function Zeitstempel() {
			let Zeitwert = new Date().toISOString().slice(2, 19);
			Zeitwert = Zeitwert.slice(0, 8) + "_" + Zeitwert.slice(9, 11) + Zeitwert.slice(12, 14) + Zeitwert.slice(15, 17);
			return Zeitwert;
		}


		function exportjson() {

			let filename = Zeitstempel() + " - Einsatzabschnitt";
			let text = EA;
			let element = document.createElement('a');
			element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(EA)));
			element.setAttribute('download', filename + ".BAO");

			element.style.display = 'none';
			document.body.appendChild(element);

			element.click();

			document.body.removeChild(element);
		}


		function IndexENr(WertENr) { //die Funktion ermittelt den Index zur ENr (DatensatzID)
			for (let i = 0; i < EA.length; i++) {
				if (EA[i].ENr == WertENr) { return i; }
			}
		}


		function speichernhtml() {

            // Array in JSON umwandeln
            var EA_AlsJSON = JSON.stringify(EA);
            
            // JSON in HTML speichern (als Beispiel im body-Element)
            document.body.setAttribute('EA-DATA', EA_AlsJSON);
            
            // Den gesamten HTML-Code der Seite erfassen
            var htmlCode = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
            
            // Erstellen eines Blob-Objekts mit dem HTML-Code
            var blob = new Blob([htmlCode], { type: "text/html" });
            
            // Erstellen eines Download-Links
            var a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = Zeitstempel() + " - Grafischer Befehl.html";
            
            // Hinzufügen des Links zum DOM und Auslösen des Klicks
            document.body.appendChild(a);
            a.click();
            
            // Entfernen des Links aus dem DOM
            document.body.removeChild(a);
        }

		function importJSON() {
			// Dateiinput-Element auswählen
			var fileInput = document.getElementById('fileInput');

			// Sicherstellen, dass eine Datei ausgewählt wurde
			if (!fileInput.files.length) {
				alert('Bitte wählen Sie eine Datei aus.');
				return;
			}

			// FileReader erstellen
			var reader = new FileReader();

			// Event-Handler für das Laden der Datei
			reader.onload = function (e) {
				try {
					// JSON-Parsing
					var ImportierteEA = JSON.parse(e.target.result);

				} catch (error) {
	
					alert("Es ist ein Fehler aufgetreten! Die Datei wurde nicht importiert!");
					return;
				}

				let groessteEANr = Math.max(...EA.map(obj => obj.ENr));

				ImportierteEA.forEach((ImportierterDatensatz) => {

					ImportierterDatensatz.ENr = ImportierterDatensatz.ENr + groessteEANr;

					ImportierterDatensatz.UANr.forEach((ImportUANr, i) => {
						ImportUANr = ImportUANr + groessteEANr;
						ImportierterDatensatz.UANr[i] = ImportUANr;
					});

					if (ImportierterDatensatz.darüber) ImportierterDatensatz.darüber = ImportierterDatensatz.darüber + groessteEANr;

					EA.push(ImportierterDatensatz);
				});

				Ansichten_aktualisieren();

			};

			//Datei lesen
			reader.readAsText(fileInput.files[0]);
			document.getElementById("Import").style.visibility = "hidden";
		}


//EA verschieben oder verändern

		function shiftLeft() { //Berechnungsfunktion, um die Einsatzabschnitte nach links zu verschieben
			
			let ShiftEA = EA.find(elem => elem.ENr === EA_select);
			let ShiftEAoben = EA.find(elem => elem.ENr === ShiftEA.darüber);
			const index = ShiftEAoben.UANr.indexOf(EA_select);
		    if (index > 0 && index < ShiftEAoben.UANr.length) {
		        const element = ShiftEAoben.UANr.splice(index, 1)[0];  	// Entferne das Element an der gegebenen Position
		        ShiftEAoben.UANr.splice(index - 1, 0, element);			// Füge es vor dem Element an der Position (index - 1) ein
			    }
			Ansichten_aktualisieren();
	    }


		function shiftRight() { //Berechnungsfunktion, um die Einsatzabschnitte nach rechts zu verschieben	

            let ShiftEA = EA.find(elem => elem.ENr === EA_select);
			let ShiftEAoben = EA.find(elem => elem.ENr === ShiftEA.darüber);
        	const index = ShiftEAoben.UANr.indexOf(EA_select);
			if (index >= 0 && index < ShiftEAoben.UANr.length - 1) {
				const element = ShiftEAoben.UANr.splice(index, 1)[0];		// Entferne das Element an der gegebenen Position
				ShiftEAoben.UANr.splice(index + 1, 0, element); 			// Füge es am Ende des Arrays ein
			}

			Ansichten_aktualisieren();
		}


		function EA_entlassen(EA_Nr) {

			let Bestätigung = confirm("Soll der EA wirklich aus dem Einsatz enlassen bzw. aus dieser BAO ausgeglieder werden? Sollten unterstellten UA vorhanden sein, bleiben diese in ihrem bestehenden Unterstellungsverhältnis. Der EA wird in der Gesamt-BAO als eigener Einsatz angezeigt. Umgliederungen können in der Gesamt-BAO-Ansicht geändert werden. ");
			if (Bestätigung) { EA_entlassen2(EA_Nr); }
		}


		function EA_entlassen2(EA_Nr) {

			let a7EA = EA.find(elem => elem.ENr === EA_Nr);
			let a8EA = EA.find(elem => elem.ENr === a7EA.darüber);
			a7EA.darüber = "";
			let x = 0;

			for (let LUA of a8EA.UANr) {
				if (EA_Nr == LUA) { a8EA.UANr.splice(x, 1); }
				x++;
			}

			Ansichten_aktualisieren();
		}


		function neuerEA()
		{

			let nENr = Math.max(...EA.map(obj => obj.ENr)) + 1;

			if (nENr == "-Infinity") nENr = 1;

			let neueNr = EA.length;

			EA[neueNr] = new Object();
			EA[neueNr]["ENr"] = nENr;
			EA[neueNr]["UANr"] = [];
			EA[neueNr]["darüber"] = EA_select; // hier wird der Datensatz darüber festgelegt.
			EA[neueNr]["EBezeichnung"] = "EA " + (nENr-1);
			EA[neueNr]["EDatum"] = "n.n.";
			EA[neueNr]["EAnlass"] = "n.n.";
			EA[neueNr]["EFührer"] = "n.n.";
			EA[neueNr]["EDst"] = "n.n.";
			EA[neueNr]["EFTelefon"] = "n.n.";
			EA[neueNr]["EFRufname"] = "n.n.";
			EA[neueNr]["EDigi"] = "n.n.";
			EA[neueNr]["LFüGr"] = "n.n.";
			EA[neueNr]["FüGrRufname"] = "n.n.";
			EA[neueNr]["FüGrTelefon"] = "n.n.";
			EA[neueNr]["FüGrKräfte"] = "n.n.";
			EA[neueNr]["Kräfte"] = "n.n.";
			EA[neueNr]["MZMO"] = "n.n.";
			EA[neueNr]["EZEO"] = "n.n.";
			EA[neueNr]["FEM"] = "n.n.";
			EA[neueNr]["Einzelaufträge"] = "n.n.";
			EA[neueNr]["SMH"] = "n.n.";

			if (EA_select) { 
			    let a5EA = EA.find(elem => elem.ENr === EA_select);
			    a5EA["UANr"].push(nENr); // bei UANr. die aktuelle EA-Nr angehängen
			} else {
			EA_select = nENr;
			EA[neueNr]["EBezeichnung"] = "PF " + (nENr-1);
			
			}
			
		}


		function EA_löschen() {

			let Bestätigung = confirm("Soll der EA wirklich gelöscht werden? Die unterstellten UA werden ebenfalls gelöscht und können nicht wiederhergestellt werden. ");
			
			if (Bestätigung) {
				
				for (let DS of EA) {
				    if (DS.ENr = EA_select) {let EA_select_neu = DS.darüber;}
				}
				
				console.log("EA_select: " + EA_select)
				
				EA_löschen2(EA_select);
				
				EA_select = EA_select_neu;
				
				Ansichten_aktualisieren();
			}
		}


		function EA_löschen2(EntferneEA) {
		    
		        console.log("EntferneEA :" +  EntferneEA);
		        
				let IndexLöschen = IndexENr(EntferneEA);
				
				if (EA[IndexLöschen].darüber) EA_entlassen2(EntferneEA); // Verbindung darüber löschen
				
				EA_löschen3(EntferneEA); // erst dann die Einsätze nacheinander löschen
		}


		function EA_löschen3(EntferneEA) {
		    
				let IndexLöschen = IndexENr(EntferneEA);
				
				for (let EAL of EA[IndexLöschen].UANr) EA_löschen3(EAL); // erst eventuell vorhandene UA löschen

				// EA löschen
				let nDsNr = false;

				if (EA[IndexLöschen].ENr == DsNr) {nDsNr = true;} //wenn der fokussierte Datensatz gelöscht wird, muss ein neuer Datensatz festgelegt werden. 
				EA.splice(IndexLöschen, 1);

				if (nDsNr) {
					for (let neuerDsNr of EA) {
						if (!neuerDsNr.darüber) DsNr = neuerDsNr.ENr; // der erste Datensatz, der ohne "darüber" gefunden wird, bekommt den Focus!
					}
				}
		}			

		function EAplus() {
                neuerEA();  
			    Ansichten_aktualisieren();
		}


		function BAOplus() {
		    
		        EA_select = "";
				neuerEA();
				
				Ansichten_aktualisieren();
		}


		function neu() {
				let Bestätigung = confirm("ACHTUNG! Es werden alle Daten gelöscht, die Datei aber nicht überschrieben. Sie können die Datei anschließend unter einem anderen Namen speichern! Soll eine neue BAO/ein neuer Grafischer Befehl angelegt werden?");
				if (Bestätigung) {
					EA = []; // alle Daten löschern
					EA_select="";
					neuerEA();
					EA_select = 1;
					DsNr = EA[0].ENr;
					EA[0].darüber = "";
					EA[0].EBezeichnung = "PF 1"; 
					neuerEA(EA[0].ENr);
					neuerEA(EA[0].ENr);
					neuerEA(EA[0].ENr);
            
                    EA_select = 1;

					Ansichten_aktualisieren();
	            }
		}


		function Höher_Stufen() { //setzt den Fokus auf den darüberliegenden EA
		    let DS = EA.find(elem => elem.ENr === DsNr); //DS="Datensatz"
	    	if (DS.darüber) { DsNr = DS.darüber; }

	    	Ansichten_aktualisieren();
	    	
        }
        
        function EA_löschen_StufeA() { //Prüfung ob EA.darüber vorhanden ist. Wenn ja, dann dort Bezug trennen
             
            let Bestätigung = confirm("Soll der EA wirklich gelöscht werden? Die eventuell vorhandenen unterstellte UA werden ebenfalls gelöscht und können nicht wiederhergestellt werden. ");
            
            if (Bestätigung) {
               	
               	let DS = EA.find (elem => elem.ENr === EA_select);
             	
             	if (DS.darüber) { //ja, ist vorhanden, dann...
				    let DS1 = EA.find (elem => elem.ENr === DS.darüber);
                    for (let i = 0; i < DS1.UANr.length; i++) { //Index feststellung
					        if (DS1.UANr[i] == EA_select) {
			                DS1.UANr.splice(i, 1); //UANr herauslöschen
         			        }
		            }
		         } 
		        
		        EA_löschen_StufeB(EA_select);
		        
		        Ansichten_aktualisieren();
            }
        }
        
        
        function EA_löschen_StufeB(DS_löschen) { //prüfen ob weitere UA vorhanden sind, dann diese zuerst löschen 

                let DS = EA.find (elem => elem.ENr === DS_löschen);
                
                if (DS.UANr) { //sind vorhanden, sind dann auch zuerst zu löschen
                    for (let UA_DS of DS.UANr) {
                        EA_löschen_StufeB(UA_DS);
                    }
                }
                
                if (EA.length == 1) { //
                    alert("Der letzte Datensatz kann nicht gelöscht werden. Sie können ggf. eine neue Dattei anlegen.");
                    Ansichten_aktualisieren();
                    return;
                }
                
                if (DS.darüber) { //neuen Focus festlegen
                   EA_select = DS.darüber; 
                } else {
             
                    for (let DS1 of EA) {
                        if (!DS1.darüber) {
                            if (DS_löschen != DS1.ENr) {
                                EA_select = DS1.ENr;
                                break;
                            } 
                        } 
                    }
                }
 
                for (let i = 0; i < EA.length; i++) { //Datensatz löschen
				        if (EA[i].ENr == DS_löschen) {
				            EA.splice(i, 1); //EA löschen
				        }
		        }
		        
		        
                if (DS_löschen == DsNr) { //DsNr neu vergeben wenn benötigt
                    for (let DS2 of EA) {
                        if (!DS2.darüber) {
                            DsNr = DS2.ENr;
                            EA_select = DS2.ENr;
                            break;
                        }                        
                    }
                }
		        
		            
        }


	</script>


</body></html>