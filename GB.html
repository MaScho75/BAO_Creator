<!DOCTYPE html>
<html lang="de"><head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="noindex" name="robots">
		<meta content="nofollow" name="robots">
		<meta content="no-cache" http-equiv="cache-control">
		<meta content="EPHK Schommer, Marcel, A 45/4, marcel.schommer@polizei.berlin.de" name="author">
		<meta content="(c)2025 - Polizei Berlin" name="copyright">
		<title>BAO Creator 2025</title>
		

<style type="text/css"> 
	
	
/* Schriften */

	body {
    	font-family:  arial;
		display: flex;
	}
	
	pre {
		white-space: pre-wrap;
		font-family: arial;
		margin: 0px;
	}
		
	p {
		font-size: 12px;
		margin: 0px;
		padding: 0px;
	}

	li {
		font-size: 12px;
		margin: 0px;
		padding: 0px;
	}

	p.digi {
		text-align: center;
		margin-top: -24px;
		margin-bottom: 15px;
		font-size: 12px;
		text-align: center;
	}


/* Seiten */
	
	#Seite {
	width: 1000px;
	height: 700px;
	padding: 0;
	z-index: 200;
	}

	#BAOFenster {
	visibility: hidden;
	padding: 10px;
	position: absolute;
	top: 0px;
	z-index: 250;
	}

	#Formular {
	border: solid black thin;
	background-color: rgb(207 220 229);
	visibility: hidden;
	padding: 20px;
	position: absolute;
	top: 10px;
	z-index: 300;
	}

	#Import {
	margin: 10px;
	border: solid black thin;
	background-color: rgb(194 159 99);
	visibility: hidden;
	padding: 20px;
	position: absolute;
	
	top: 10px;
	z-index: 400;
	}

	#InfoBox {
	width: 600px;
	height: 600px;	
	position: absolute;
	top: 10px;
	padding: 15px;
	overflow: auto;
	z-index: 1200;
	background-color: rgb(207, 220, 229);
	visibility: hidden;	
	}

	#Toolbox {
    width: 150px;
    margin: 10px;
    display: block;
    flex-wrap: wrap;
    align-content: flex-start;
    align-items: center;
	padding: 10px;
	z-index: 600;
	border: solid thin;
	background-color: rgba(250, 250, 250, 0.5);
	text-align: center;
	}

/* Toolboxelemente */

	.plus {
	font-size: 12px;
	width: 100%;
	height: 25px;
	margin: 2px;
	text-align: left;	
	border-width: 1px;	
    }

	.plus:hover {
	    background-color: rgba(100, 100, 100, 0.5);
	}
	
	#Schere {
	position: absolute;
	display: none;
	left: 65px;
	border: dotted thin green;
	top: 63px;
	text-align: center;
	font-size: 30px;
	margin: 0px;
	z-index: 500;
	}

	#Papierkorb {
	position: absolute;	
	display: none;
	left: 15px;
	border: dotted thin red;
	top: 63px;
	text-align: center;
	font-size: 30px;
	margin: 0px;
	z-index: 500;
	}

	#InfoBoxSchlie√üenButton {
	font-size: 20px;
	font-weight: bold;
	}
	
/* unsortiert */

	#Digigruppe {
	height: 55px;
	}

    #Linien {
	position: absolute;
    width: 200%;
    height: 100%;
    top: 0px;
    left: -200px;
    }


	#LinienGB {
	position: absolute;
	display: block;
	width: 120%px;
	height: 500px;
	top: 0px;
	left: 0px;
	z-index: -100;
	}
	
	#LinieGB {
	position: absolute;
	left: 0px;
	top: 0px;
	height: 100%;
	width: 100%;
	}

	.KMEintrag {
	background-color: #f9f9f9;
	}

	.KMEintrag:hover {
	background-color: rgba(200, 200, 200, 0.888);
	}

	.contextMenu {
	display: none;
	position: absolute;
	background-color: #f9f9f9;
	border: 1px solid #ccc;
	padding: 8px;
	box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
	z-index: 500;
	}



	.EAF√úGr {
	border: 1px solid;
	border-bottom: none;
	padding: 5px;
	text-align: left;
	font-size: 12px;
	grid-row: 1 / 1;
	margin: 0px 5px;
	}

	.EAF√úGr:hover {
	background-color: rgba(200, 200, 200, 0.888);
	;
	}

	.EAEinzelA {
	border: 1px solid;
	padding: 5px;
	text-align: left;
	font-size: 12px;
	grid-row: 2 / 2;
	margin: 0px 5px;
	}

	.EAZeile {
	display: grid;
	grid-template-columns: repeat(6, minmax(auto, auto));
	grid-template-rows: repeat(3, auto);
	/*grid-gap: 15px;*/
	}

	.EADigi {
	grid-row: 3 / 3;
	text-align: center;
	}

	.EAKn√∂pfe {
	grid-row: 4 / 4;
	text-align: center;
	margin: 15px;
	}

	.EABlock√úberschrift {
	text-align: center;
	color: white;
	background-color: rgb(0, 34, 102);
	font-size: 14px;
	font-weight: bold;
	padding: 5px 5px;
	}

	.EABlockInhalt {
	text-align: center;
	font-size: 12px;
	padding: 0px 5px;
	}

	.Block {
	padding: 0px 5px;
	display: table-cell;
	position: relative;
	z-index: 260;
	}

	.Kasten {
	margin: 20px;
	border: solid rgb(0, 34, 102) thin;
	width: max-content;
	margin-left: auto;
	margin-right: auto;
	}

	.Kasten:hover {
	background-color: rgba(200, 200, 200, 0.888);
	}

	#BAOSchlie√üen {
	position: absolute;
	left: 10px;
	top: 10px;
	}



	#BAOGrafik {
	z-index: 260;
	}

	#FEM {
	height: 50px;
	width: 100%;
	}

	#EAnlass {
	height: 50px;
	width: 300px;
	}

	#Kr√§fte {
	width: 100%;
	height: 50px;
	}

	#F√ºGrKr√§fte {
	width: 100%;
	height: 50px;
	}

	#SpalteEinzelauftr√§ge {
	width: 220px;
	}

	#Einzelauftr√§ge {
	width: 300px;
	height: 365px;
	}

	#UASMH {
	width: 250px;
	height: 443px;
	}

	.center {
	text-align: center;
	}

	.EAKnopf {
	width: 80%;
	margin: 5px;
	border: none;
	font-size: 12px;
	box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	border-radius: 3px;
	background-color: rgb(192, 0, 34);
	color: white;

	}

	#Dienststelle {
	font-size: 15px;
	font-weight: normal;
	text-align: left;
	margin: 0px;
	}

	#√úberschrift {
	font-size: 20px;
	font-weight: bold;
	text-align: center;
	margin: 0px;
	}

	#Stand {
	text-align: right;
	font-size: 10px;
	vertical-align: top;
	}

	#kopf {
	display: flex;
	font-size: 12px;
	}

	#kopf:hover {
		background-color: rgba(200, 200, 200, 0.888);
	}

	.kopfteil {
	height: 100px;
	border: 1px solid;
	padding: 5px;
	}

	#Polizeif√ºhrer {
	margin: 0px 10px 0px 10px;
	width: 200px;
	}

	#Anlass {
	width: 400px;
	}

	#F√ºhrungsgruppe {
	width: 400px;
	}

	.digi {
	font-size: 12px;
	}

	#SMH {
	margin: 5px;
	font-size: 14px;
	font-weight: normal;
	text-align: left;
	}


	.menubutton {
	width: 100px;
	margin: 5px 10px;
	border: none;
	font-size: 12px;
	box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	border-radius: 3px;
	background-color: rgb(0 34 102);
	color: white;
	}

	.editorbutton {
	width: 200px;
	height: 40px;
	margin: 10px 0px;
	border: solid thin;
	}

	.Spalte1 {
	width: 110px;
	vertical-align: top;
	text-align: right;
	padding-right: 10px;
	}

	.Spalte2 {
	width: 220px;
	}

	input {
	width: 220px;
	font-family: courier new;
	}	
	
	.Button_Formular {
	    width: 200px;
        height: 40px;
        margin: 10px;
	}
	
/* nicht druckbare Elemente */
	@media print {
 		hr.nichtdrucken,
		#Toolbox
		{
        display: none;
    	}
	}	
		
	</style>
			
	</head>
	
	<body ea-data="[{&quot;ENr&quot;:1,&quot;UANr&quot;:[2,3,4],&quot;dar√ºber&quot;:&quot;&quot;,&quot;EBezeichnung&quot;:&quot;PF 1&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EF√ºhrer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LF√ºGr&quot;:&quot;n.n.&quot;,&quot;F√ºGrRufname&quot;:&quot;n.n.&quot;,&quot;F√ºGrTelefon&quot;:&quot;n.n.&quot;,&quot;F√ºGrKr√§fte&quot;:&quot;n.n.&quot;,&quot;Kr√§fte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelauftr√§ge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:2,&quot;UANr&quot;:[],&quot;dar√ºber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 1&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EF√ºhrer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LF√ºGr&quot;:&quot;n.n.&quot;,&quot;F√ºGrRufname&quot;:&quot;n.n.&quot;,&quot;F√ºGrTelefon&quot;:&quot;n.n.&quot;,&quot;F√ºGrKr√§fte&quot;:&quot;n.n.&quot;,&quot;Kr√§fte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelauftr√§ge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:3,&quot;UANr&quot;:[],&quot;dar√ºber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 2&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EF√ºhrer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LF√ºGr&quot;:&quot;n.n.&quot;,&quot;F√ºGrRufname&quot;:&quot;n.n.&quot;,&quot;F√ºGrTelefon&quot;:&quot;n.n.&quot;,&quot;F√ºGrKr√§fte&quot;:&quot;n.n.&quot;,&quot;Kr√§fte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelauftr√§ge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;},{&quot;ENr&quot;:4,&quot;UANr&quot;:[],&quot;dar√ºber&quot;:1,&quot;EBezeichnung&quot;:&quot;EA 3&quot;,&quot;EDatum&quot;:&quot;n.n.&quot;,&quot;EAnlass&quot;:&quot;n.n.&quot;,&quot;EF√ºhrer&quot;:&quot;n.n.&quot;,&quot;EDst&quot;:&quot;n.n.&quot;,&quot;EFTelefon&quot;:&quot;n.n.&quot;,&quot;EFRufname&quot;:&quot;n.n.&quot;,&quot;EDigi&quot;:&quot;n.n.&quot;,&quot;LF√ºGr&quot;:&quot;n.n.&quot;,&quot;F√ºGrRufname&quot;:&quot;n.n.&quot;,&quot;F√ºGrTelefon&quot;:&quot;n.n.&quot;,&quot;F√ºGrKr√§fte&quot;:&quot;n.n.&quot;,&quot;Kr√§fte&quot;:&quot;n.n.&quot;,&quot;MZMO&quot;:&quot;n.n.&quot;,&quot;EZEO&quot;:&quot;n.n.&quot;,&quot;FEM&quot;:&quot;n.n.&quot;,&quot;Einzelauftr√§ge&quot;:&quot;n.n.&quot;,&quot;SMH&quot;:&quot;n.n.&quot;}]">

	<div id="Gesamtansicht" style="display: flex; flex-direction: row;">
	
	<!---- Toolbox ---->
		<div id="Toolbox" style="visibility: visible; display: block;">
			<p><b>Toolbox</b></p>
			
			<button class="plus" id="NEU" onclick="neu();">neue Datei</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="Speichern" onclick="speichernhtml();">üíæ   speichern unter</button>
			<button class="plus" id="Export" onclick="exportjson();">Export</button>
			<button class="plus" id="Importieren" onclick="Import();">Import</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="√úbersicht" onclick="√úbersicht();" disabled="">Gesamt√ºbersicht</button>
			<button class="plus" id="AA" onclick="Ansichten_aktualisieren();">Ansicht aktualisieren</button>
			<button class="plus" id="BAO_GB" onclick="BAO_GB();" disabled="">BAO / GB</button>
			<button class="plus" id="BAO2" onclick="BAO_√∂ffnen2();">BAO des EA</button>
			<button class="plus" id="GB2" onclick="GB_√∂ffnen2();">GB des EA</button>
			<button class="plus" id="Hoch" onclick="H√∂her_Stufen();" disabled="">√ºbergeordneter EA</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="Stift" onclick="Editor();">‚úé - EA beearbeiten </button>
			<button class="plus" id="addEA" onclick="EAplus();">+ EA</button>
			<button class="plus" id="addEinsatz" onclick="BAOplus();">+ Einsatz</button>
			<button class="plus" id="entlassen" onclick="EA_entlassen(EA_select);" disabled="">EA entlassen</button>
			<button class="plus" id="l√∂schen" onclick="EA_l√∂schen_StufeA();"><span style="color: red">X </span>- EA l√∂schen</button>
			<button class="plus" id="links" onclick="shiftLeft();" disabled="">‚Üê EA verschieben</button>
			<button class="plus" id="rechts" onclick="shiftRight();" disabled="">‚Üí EA verschieben</button>
			
			<svg width="140" height="10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="5" x2="140" y2="5" stroke="black" stroke-width="1"></line></svg>
			
			<button class="plus" id="InfoBoxButton" onclick="InfoBox_√∂ffnen();">Info/Hilfe</button>

			<button class="plus" id="DruckButton" onclick="drucken();">drucken</button>

		</div>
		
		<div id="zweiteSeite">	
		<!---- Grafischer Befehl ---->
			<div id="Seite" style="visibility: hidden;">
			<table width="100%">
				<tbody>
					<tr>
						<td id="Dienststelle">n.n.</td>
						<td id="√úberschrift">
							Grafischer Befehl - VS-nfD - <span id="EDatum">n.n.</span> - <span id="EinsatzID">1 - Ausgew√§hlt: 1</span></td>
						<td id="Stand">25-01-18 - 10-58-07</td>
					</tr>
				</tbody>
			</table>
			<div id="kopf" style="background-color: rgba(240, 210, 140, 0.886);">
				<div class="kopfteil" id="Anlass"><b>Anlass</b><br><pre>n.n.</pre></div>
				<div class="kopfteil" id="Polizeif√ºhrer"><b>Polizeif√ºhrer/in</b><br>n.n.<br>n.n.<br>n.n.</div>
				<div class="kopfteil" id="F√ºhrungsgruppe">
					<b>F√ºhrungsgruppe</b><br>
					<table style="width: 100%">
						<tbody>
							<tr>
								<td id="F√ºGr1" style="width: 50%" valign="TOP">n.n.<br>n.n.<br>n.n.<br><pre>n.n.</pre></td>
								<td id="F√ºGr2" style="width: 50%" valign="TOP">MZO:<br>‚ÄÇn.n.<br>EZO:<br>‚ÄÇn.n.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<div id="Digigruppe">
	
				<svg id="LinienGB"><line x1="318.328125" y1="204" x2="318.328125" y2="174" stroke="black"></line><line x1="554.984375" y1="204" x2="554.984375" y2="174" stroke="black"></line><line x1="791.6484375" y1="204" x2="791.6484375" y2="174" stroke="black"></line><line x1="318.328125" y1="174" x2="791.6484375" y2="174" stroke="black"></line></svg>
				<svg height="46" style="background-color: white; margin-left: 427px;" width="140px"> 
					<path d="M20,5 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: white"></path> 
					<text class="digi" style="font-weight: bold;" x="38" y="20">Digigruppe</text> 
				</svg>
				<p class="digi" id="DGruppe">n.n.</p>
			</div>
			
			<div id="Einsatzabschnitte"><div class="EAZeile"><div class="EAF√úGr" id="Einsatzabschnitt2"><p style="text-align: center"><b>(2) EA 1</b></p><hr><p>F√ºhrer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kr√§fte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelauftr√§ge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p><div class="EAF√úGr" id="Einsatzabschnitt3"><p style="text-align: center"><b>(3) EA 2</b></p><hr><p>F√ºhrer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kr√§fte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelauftr√§ge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p><div class="EAF√úGr" id="Einsatzabschnitt4"><p style="text-align: center"><b>(4) EA 3</b></p><hr><p>F√ºhrer: n.n.</p><hr><p>Telefon: n.n. / n.n.</p><hr><p>Rufname: n.n. / n.n.</p><hr><p>Kr√§fte: </p><pre>n.n.</pre><p></p><hr><p>MZO: n.n.</p><hr><p>EZO: n.n.</p></div><div class="EAEinzelA"><b>Einzelauftr√§ge:</b><br><pre>n.n.</pre><p></p></div><p class="EADigi"><svg style="margin-bottom: -26px" width="140px" height="55"><text class="digi" x="38" y="25" style="font-weight: bold;">Digigruppe</text><path d="M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z" stroke="black" style="fill: none"></path></svg><br><span>n.n.</span></p></div></div>
			<hr class="nichtdrucken" style="margin-top: 15px">
			<p style="margin: 5px; font-size: 20px; text-align: left;">
				<b>Sonstigen Ma√ünahnen und Hinweise</b></p>
			<div id="SMH"><pre>n.n.</pre></div>
			</div>
		
		<!---- Formular ---->
			<div id="Formular" style="visibility: hidden;">
			<form name="EAEingabe">
				<table>
					<tbody>
						<tr valign="top">
							<td style="padding: 10px; width: 350px;">
								<table>
									<tbody>
										<tr id="SpalteEBezeichnung">
											<td class="Spalte1">
												<label for="EBezeichnung">Bezeichnung</label></td>
											<td class="Spalte2">
												<input id="EBezeichnung" name="EBezeichnung"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDatum">Einsatzdatum</label></td>
											<td class="Spalte2">
												<input id="EiDatum" name="EDatum"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EF√ºhrer">F√ºhrer/in</label></td>
											<td class="Spalte2">
												<input id="EF√ºhrer" name="EF√ºhrer"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDst">Dienststelle</label></td>
											<td class="Spalte2">
												<input id="EDst" name="EDst"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EFRufname">Rufname</label></td>
											<td class="Spalte2">
												<input id="EFRufname" name="EFRufname"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EFTelefon">Telefon</label></td>
											<td class="Spalte2">
												<input id="EFTelefon" name="EFTelefon"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="LF√ºGr">LF√ºGr</label></td>
											<td class="Spalte2">
												<input id="LF√ºGr" name="LF√ºGr"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="F√ºGrRufname">F√ºGr-Rufname</label></td>
											<td class="Spalte2">
												<input id="F√ºGrRufname" name="F√ºGrRufname"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="F√ºGrTelefon">F√ºGr-Telefon</label></td>
											<td class="Spalte2">
												<input id="F√ºGrTelefon" name="F√ºGrTelefon"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="F√ºGrKr√§fte">F√ºGr-Kr√§fte</label></td>
											<td class="Spalte2">
												<span id="FeldF√ºGrKr√§fte" name="FeldF√ºGrKr√§fte"><textarea id="F√ºGrKr√§fte">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="Kr√§fte">Kr√§fte</label></td>
											<td class="Spalte2">
												<span id="FeldKr√§fte" name="FeldKr√§fte"><textarea id="Kr√§fte">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="MZMO">MZO</label></td>
											<td class="Spalte2">
												<input id="MZMO" name="MZMOA"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EZEO">EZO</label></td>
											<td class="Spalte2">
												<input id="EZEO" name="EZEO"></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="FEM">FEM</label></td>
											<td class="Spalte2">
												<span id="FeldFEM" name="FeldFEM"><textarea id="FEM">n.n.</textarea></span></td>
										</tr>
										<tr>
											<td class="Spalte1">
												<label for="EDigi">Digi</label></td>
											<td class="Spalte2">
												<input id="EDigi" name="EDigi"></td>
										</tr>
									</tbody>
								</table>
							</td>
						<!-- Spalte 2 -->	
							<td id="SpalteEinzelauftr√§ge" style="padding: 10px; width: 300px;" valign="top">
								
								<label for="EAnlass">Anlass</label><br>
								<span id="FeldEAnlass" name="FeldEAnlass"><textarea id="EAnlass">n.n.</textarea></span>

								<label for="Einzelauftr√§ge">Einzelauftr√§ge</label><br>
								<span id="FeldEinzelauftr√§ge" name="FeldEinzelauftr√§ge"><textarea id="Einzelauftr√§ge">n.n.</textarea></span>

							</td>

						<!-- Spalte 3 -->		
							<td id="SpalteSMH" style="padding: 10px; width: 200px;" valign="top">
								
								<label for="UASMH">sonstige Ma√ünahmen und Hinweise</label><br>
								<span id="FeldUASMH" name="FeldUASMH"><textarea id="UASMH">n.n.</textarea></span></td>
								
							
						</tr>
					</tbody>
				</table>
			</form>
			<button class="Button_Formular" id="√ºbertragen" onclick="ESpeichern();">√úbertragen</button><button class="Button_Formular" id="schlie√üen" onclick="Schlie√üen();">ohne speichern schlie√üen</button><br>
			<!--Kontrollfelder-->
			
			<p style="font-family: Courier New; font-size: 10px; ">
				EANr:<span id="KonEANr">4</span>- UANr: <span id="KonUANr"></span></p>
			</div>
		
		<!---- Import ---->
		<div id="Import" style="visibility: hidden;">
			<h1>BAO importieren</h1>
			<p>
				<input id="fileInput" type="file"><button class="" onclick="importJSON()" style="width: 200px;">Laden</button><button class="plus" id="hoch" onclick="document.getElementById('Import').style.visibility = 'hidden';" style="width: 200px;">Schlie√üen</button></p>
		</div>
		
		<!---- BAO ---->
			<div id="BAOFenster" style="visibility: visible;">
		    	<h1 style="text-align: center; margin: 0; margin-left: 200px;">
			    	BAO</h1>
				<p id="BAO_Anlass"><b>*** GESAMT√úBERSICHT ***</b></p>
		    	
				<div id="Linie">
		    			<svg id="Linien"><path d="M 353.046875,193v 20 " stroke="black"></path><line x1="261.015625" y1="213" x2="445.078125" y2="213" stroke="black"></line><path d="M 261.015625,233v -20 " stroke="black"></path><path d="M 353.046875,233v -20 " stroke="black"></path><path d="M 445.078125,233v -20 " stroke="black"></path></svg>
    			</div>

				<div id="BAOGrafik"><div class="Block"><div id="Block1" class="Kasten" style="background-color: rgba(240, 210, 140, 0.886);"><p id="EAB√ú1" class="EABlock√úberschrift">PF 1</p><p class="EABlockInhalt">ENr: 1</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: 2,3,4</p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EF√ºhrer: n.n.</p><p class="EABlockInhalt">Kr√§fte: n.n.<br></p></div><div class="Block"><div id="Block2" class="Kasten"><p id="EAB√ú2" class="EABlock√úberschrift">EA 1</p><p class="EABlockInhalt">ENr: 2</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EF√ºhrer: n.n.</p><p class="EABlockInhalt">Kr√§fte: n.n.<br></p></div></div><div class="Block"><div id="Block3" class="Kasten"><p id="EAB√ú3" class="EABlock√úberschrift">EA 2</p><p class="EABlockInhalt">ENr: 3</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EF√ºhrer: n.n.</p><p class="EABlockInhalt">Kr√§fte: n.n.<br></p></div></div><div class="Block"><div id="Block4" class="Kasten"><p id="EAB√ú4" class="EABlock√úberschrift">EA 3</p><p class="EABlockInhalt">ENr: 4</p><p class="EABlockInhalt">EDatum: n.n.</p><p class="EABlockInhalt">UANr: </p><p class="EABlockInhalt">EDst: n.n.</p><p class="EABlockInhalt">EF√ºhrer: n.n.</p><p class="EABlockInhalt">Kr√§fte: n.n.<br></p></div></div></div></div>
			</div>
		
	    		
		<!---- Infobox ---->
		<div id="InfoBox" style="visibility: hidden;">
			<p>Sehr geehrte Kollegin,<br>
				sehr geehrter Kollege,<br><br></p>
			<p>
				ich stelle Dir hier den <b>"BAO-Creator"</b> vor. Dabei handelt es sich um eine M√∂glichkeit, auf einfache Weise eine BAO und den dazugeh√∂rigen Grafischen Befehl in einer einzigen Datei zu erstellen, zu speichern und zu verschicken.</p>
			<p>
				Daraus ergeben sich vielf√§ltige M√∂glichkeiten bei der Planung und Durchf√ºhrung von Polizeieins√§tzen. Die M√∂glichkeiten und die weitreichenden Vorteile zur Nutzung des BAO-Creators m√∂chte ich euch hier stichpunktartig vorstellen:</p>
			<ul>
				<li>
					Erstellung und Pr√§sentation von polizeilichen BAO und grafischen Befehlen</li>
				<li>
					nur eine einzige Datei - kein klassisches Programm oder eine App</li>
				<li>
					PDV 100 konform</li>
				<li>
					einfache und selbsterkl√§rende Bedienung</li>
				<li>
					Darstellung und Erstellung von gro√üe BAO mit mehreren Ebenen (EA/UA/UUA/UUUA etc.)</li>
				<li>
					Darstellung von mehreren BAO gleichzeitig nebeneinander</li>
				<li>
					Umgliederung im laufenden Einsatz per "Drag and Drop" bei automatischer Anpassung der Grafischen Befehle</li>
				<li>
					keine Formatierungen von Texten oder grafischen Elementen</li>
				<li>
					Dokumentation von laufenden Eins√§tzen bei Umstrukturierungen der BAO</li>
				<li>
					Dokumentation der erteilten Einzelauftr√§gen im laufenden Einsatz</li>
				<li>
					Einsatz- und Unterabschnitte k√∂nnen ihre BAO/Untergliederungen und grafische Befehle einf√ºgen</li>
				<li>
					browserbasierend: Plattform- und Betriebssystemunabh√§ngig</li>
				<li>
					von auswertige Einheiten und andere Bundesl√§nder unkompliziert nutzbar</li>
				<li>
					kaum Gefahr von Viren oder Malware</li>
			</ul>
			<p>
				<b>technische Hinweise:</b></p>
			<ul>
				<li>
					Bei dem Dateiformat handelt es sich um eine html-Datei. Internetseiten sind in diesem Format gespeichert. Damit ist sie Plattformunabh√§ngig. Eine Installation ist nicht vorgesehen. Es wird lediglich ein Internetbrowser (Edge, Chrome, Firefox etc.) ben√∂tigt. Eine Internetverbindung ist nicht erforderlich. Sie kann auf jedem System mit einem Browser verwendet werden: PC, Tablet, Handy, TV-Ger√§te mit integrierter Browser-Software etc.</li>
				<li>
					Die Datei kann zentral abgelegt (Cloud, SharePoint/IntraPol, Netzwerklaufwerk) oder per Email verschickt oder auf einem USB-Speicherstick abgelegt und weitergegeben werden.</li>
				<li>
					Es wird kein gesonderte Software ben√∂tigt. Der Programmcode ist in JavaScript geschrieben und in der html- Datei selbst enthalten. Das Einbringen von Schadcode (Viren etc.) ist nicht m√∂glich. Der Programm-Code ist f√ºr alle einsehbar, und Anpassungen in der Struktur oder dem Layout lassen sich bei entsprechendem Sachverstand und Programmkenntnissen selbst realisieren oder weiter entwickeln.</li>
				<li>
					Die Eins√§tze sind als einzelne Datens√§tze gespeichert und lassen sich in und aus anderen Anwendungen portieren, z.B. Excel, Word, PowerPoint) So k√∂nnen auch verschiedene BAO und Grafische Befehle zusammengef√ºhrt werden.</li>
				<li>
					Wenn die Datei an einen zentralen Ort gespeichert und zur Verf√ºgung gestellt wird, habe Einsatzkr√§fte und EA/UA jederzeit die M√∂glichkeit, die aktuelle BAO und die aktuellen Einsatzauftr√§ge f√ºr sich und benachbarte Kr√§fte einzusehen. Ver√§nderungen und Anpassungen sind sofort sichtbar und sorgen f√ºr verbesserte Transparenz.</li>
				<li>
					Weiterentwicklungen/Update k√∂nnen einfach durch eine neue Datei ersetzt werden. Ein regul√§res Update eines Programms ist nicht erforderlich.</li>
			</ul>
			<p>
				<b>Besonderheit:</b></p>
			<p>
				Die Speicherung der Datei ist aus Sicherheitsgr√ºnden wegen der Architektur der Internetbrowser nicht ohne weiteres m√∂glich. In der Regel muss f√ºr jede Speicherung eine neue Datei angelegt werden. Dies erfolgt allerdings automatisch als Download und ist nicht aufwendig.<br><br></p>
			<p>
				<b>Ausblick</b> - folgende Erweiterungen sind mit dem vorhanden Programm bei Erweiterung des Programmcodes m√∂glich:</p>
			<ul>
				<li>
					Einbindung in ein Datenbanksystem</li>
				<li>
					Einbindung in CMS (SharePoint/IntraPol)</li>
				<li>
					Kr√§fteverwaltung</li>
				<li>
					Einrichtung unterschiedlicher Benutzerrechter mit unterschiedlichen Ebenen</li>
				<li>
					Einbindung in EPSweb-Oberfl√§che oder eines seiner Folgeprojekte</li>
			</ul>
			<p>
				Ich w√ºrde mich freuen, wenn Dir mein Tool gef√§llt und es Dir bei Deiner Arbeit ein Hilfe ist.<br><br></p>
			<p>
				Mit freundlichen Gr√º√üen</p>
			<p>
				<i>Marcel Schommer</i></p>
		</div>
    	</div>
    </div>


	<script>

		'use strict';
		
		// Daten aus dem Bodytag auslesen

		let EA_JSON = document.body.getAttribute('ea-data');
		let EA = JSON.parse(EA_JSON);
		let DsNr = EA[0].ENr; // LfdNr des Datensatzes zur Identifizierung
		let EABl√∂cke = ""; // Variable, in der die Einsatzabschnitt dargestellt werden.
		let AktuellEditDsNr; // Die Datensatznummer, die gerade editiert wird. 
		let SKnopfx = [];
		let knopfname = [];
		let Zeile = [];
		let UA = false;
		let Gesamt√ºbersicht = true; // Wir der gesamte Einsatz oder nur ein EA dargestellt?
		let DsNr_ist_Einsatz = true; 
		
		let EA_select = DsNr ; //Zeigt an, welcher EA f√ºr weitere Atkionen ausgew√§hlt ist. 

		let Blockfarbe = "rgba(240, 210, 140, 0.888)";
		
		let Text_BAO_Anlass;

        // Datum der letzten Datei√§nderung darstellen
		let letzte√Ñnderung = document.lastModified; 
		let letzte√Ñnderung2 = letzte√Ñnderung.slice(8, 10) + "-";
		letzte√Ñnderung2 += letzte√Ñnderung.slice(0, 2) + "-";
		letzte√Ñnderung2 += letzte√Ñnderung.slice(3, 5) + " - ";
		letzte√Ñnderung2 += letzte√Ñnderung.slice(11, 13) + "-";
		letzte√Ñnderung2 += letzte√Ñnderung.slice(14, 16) + "-";
		letzte√Ñnderung2 += letzte√Ñnderung.slice(17);
		document.getElementById("Stand").innerHTML = letzte√Ñnderung2;

		Ansichten_aktualisieren();
		
		BAO_√∂ffnen();

		//GB_√∂ffnen();

// Ende des regul√§ren Programmablaufes...	

// *************  ausgelagerte Funktionen


// Grafischer Befehl 

		function Einsatzkopf() {

			window.moveTo(0, 0);

			let aEA = EA.find(elem => elem.ENr === DsNr);

			let PF = "<b>Polizeif√ºhrer/in</b><br>" + aEA["EF√ºhrer"] + "<br>" + aEA["EFRufname"] + "<br>" + aEA["EFTelefon"];
			let F√ºGr1 = aEA["LF√ºGr"] + "<br>" + aEA["EFRufname"] + "<br>" + aEA["F√ºGrTelefon"] + "<br><pre>" + aEA["F√ºGrKr√§fte"] + "</pre>";
			let F√ºGr2 = "MZO:<br>&ensp;" + aEA["MZMO"] + "<br>EZO:<br>&ensp;" + aEA["EZEO"];
			let Anlass = "<b>Anlass</b><br><pre>" + aEA["EAnlass"] + "</pre>";

			document.getElementById("EinsatzID").innerHTML = DsNr + " - Ausgew√§hlt: " + EA_select ; // Einsatznummer in der √úberschrift darstellen
			document.getElementById("Anlass").innerHTML = Anlass;
			document.getElementById("EDatum").innerHTML = aEA.EDatum;
			document.getElementById("Polizeif√ºhrer").innerHTML = PF;
			document.getElementById("F√ºGr1").innerHTML = F√ºGr1;
			document.getElementById("F√ºGr2").innerHTML = F√ºGr2;
			document.getElementById("DGruppe").innerHTML = aEA.EDigi;
			document.getElementById("Dienststelle").innerHTML = aEA.EDst;
			document.getElementById("SMH").innerHTML = "<pre>" + aEA.SMH + "</pre>";

			//Kopf rot markieren

			const markierterKopf = document.getElementById("kopf");

			if (DsNr === EA_select) {markierterKopf.style.backgroundColor = Blockfarbe;}
			else {markierterKopf.style.backgroundColor = '';}	
		
			markierterKopf.addEventListener('click', function() {
				EA_select = DsNr;
				Ansichten_aktualisieren();
				
			});
			
		}


		function Einsatzabschnitte() {

			let aEA = EA.find(elem => elem.ENr === DsNr); //aktueller Einsatz

			let AnzahlEA = aEA["UANr"].length;

			if (AnzahlEA > 0) {
				switch (true) {
					case AnzahlEA < 7: Zeile[1] = 6; Zeile[2] = 0; Zeile[3] = 0; break;
					case AnzahlEA == 7: Zeile[1] = 4; Zeile[2] = 3; Zeile[3] = 0; break;
					case AnzahlEA == 8: Zeile[1] = 4; Zeile[2] = 4; Zeile[3] = 0; break;
					case AnzahlEA == 9: Zeile[1] = 5; Zeile[2] = 4; Zeile[3] = 0; break;
					case AnzahlEA == 10: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 0; break;
					case AnzahlEA == 11: Zeile[1] = 6; Zeile[2] = 5; Zeile[3] = 0; break;
					case AnzahlEA == 12: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 0; break;
					case AnzahlEA == 13: Zeile[1] = 5; Zeile[2] = 4; Zeile[3] = 4; break;
					case AnzahlEA == 14: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 4; break;
					case AnzahlEA == 15: Zeile[1] = 5; Zeile[2] = 5; Zeile[3] = 5; break;
					case AnzahlEA == 16: Zeile[1] = 6; Zeile[2] = 5; Zeile[3] = 5; break;
					case AnzahlEA == 17: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 5; break;
					case AnzahlEA == 18: Zeile[1] = 6; Zeile[2] = 6; Zeile[3] = 6; break;
				}

				EABl√∂cke = "";

				EABl√∂cke += "<div class='EAZeile'>";

				let s = 0;

				let BlockLinie = [];

				for (let x of aEA["UANr"]) {
					s++;
					if (s <= Zeile[1]) { BlockLinie.push(x); }
					if (s == Zeile[1] + 1) EABl√∂cke += "</div><hr class='nichtdrucken' style='margin-top: 15px'><div class='EAZeile'>";	// Ende Zeile 1
					if (s == Zeile[1] + Zeile[2] + 1) EABl√∂cke += "</div><hr class='nichtdrucken' style='margin-top: 15px'><div class='EAZeile'>"; // Ende Zeile 2
					let a6EA = EA.find(elem => elem.ENr === x);

					Block(x); //Block erstellen
				}

				EABl√∂cke += "</div>"; // Schluss der Zeile 1,2 oder 3

				document.getElementById("Einsatzabschnitte").innerHTML = EABl√∂cke; //html Datei erstellen
				
				//Beim Klicken eines EA den EA Ausw√§hlen und farblich markieren
				
				for (let x of aEA["UANr"]) {

					const markierterEA = document.getElementById("Einsatzabschnitt" + x);

					if (x === EA_select) {markierterEA.style.backgroundColor = Blockfarbe;}//f√§rbt den EA nach dem Klick

					markierterEA.addEventListener('click', function() {
						EA_select = x;
						Ansichten_aktualisieren();
					})
				
				}
		

				//Linien f√ºr den GB zeichnen

				let GBLinie = "";

				let EAElement;

				let korrextX = window.scrollX || window.pageXOffset; // horizontale Scrollposition
				let korrextY = window.scrollY || window.pageYOffset; // vertikale Scrollposition

				for (let StricheBG of BlockLinie) {
					EAElement = "Einsatzabschnitt" + StricheBG;

					let EAObjekt1 = document.getElementById(EAElement);
					let EAObjekt2 = EAObjekt1.getBoundingClientRect();

					GBLinie += "<line x1='";
					GBLinie += EAObjekt2.left + ((EAObjekt2.right - EAObjekt2.left) / 2) + korrextX;
					GBLinie += "' y1='";
					GBLinie += EAObjekt2.top + korrextY;
					GBLinie += "' x2='";
					GBLinie += EAObjekt2.left + ((EAObjekt2.right - EAObjekt2.left) / 2) + korrextX;
					GBLinie += "' y2='";
					GBLinie += EAObjekt2.top - 30 + korrextY;
					GBLinie += "' stroke='black'/>";
				}

				let StricheBG2 = BlockLinie[0]
				EAElement = "Einsatzabschnitt" + StricheBG2;
				let EAObjekt3 = document.getElementById(EAElement);
				let EAObjekt4 = EAObjekt3.getBoundingClientRect();
				let StricheBG3 = BlockLinie[(BlockLinie.length - 1)];
				EAElement = "Einsatzabschnitt" + StricheBG3;
				let EAObjekt5 = document.getElementById(EAElement);
				let EAObjekt6 = EAObjekt5.getBoundingClientRect();

				GBLinie += "<line x1='";
				GBLinie += EAObjekt4.left + ((EAObjekt4.right - EAObjekt4.left) / 2) + korrextX;
				GBLinie += "' y1='";
				GBLinie += EAObjekt4.top - 30 + korrextY;
				GBLinie += "' x2='";
				GBLinie += EAObjekt6.left + ((EAObjekt6.right - EAObjekt6.left) / 2) + korrextX;
				GBLinie += "' y2='";
				GBLinie += EAObjekt6.top - 30 + korrextY;
				GBLinie += "' stroke='black'/>";

				document.getElementById("LinienGB").innerHTML = GBLinie;

			} else {
				document.getElementById("Einsatzabschnitte").innerHTML = "<h1 style='text-align: center'>Keine EA vorhanden!<br></h1>";
				document.getElementById("LinienGB").innerHTML = "";
			}

		}


		function Block(EABlock) {

			let a2EA = EA.find(elem => elem.ENr === EABlock);

			EABl√∂cke += "<div class='EAF√úGr' id='Einsatzabschnitt" + a2EA["ENr"] + "'><p style='text-align: center'><b>(" + a2EA["ENr"] + ") ";
			EABl√∂cke += a2EA["EBezeichnung"] + "</b></p>";
			EABl√∂cke += "<hr><p>F√ºhrer: " + a2EA["EF√ºhrer"] + "</p>";
			EABl√∂cke += "<hr><p>Telefon: " + a2EA["EFTelefon"] + " / " + a2EA["F√ºGrTelefon"] + "</p>";
			EABl√∂cke += "<hr><p>Rufname: " + a2EA["EFRufname"] + " / " + a2EA["F√ºGrRufname"] + "</p>";
			EABl√∂cke += "<hr><p>Kr√§fte: <pre>" + a2EA["Kr√§fte"] + "</pre></p>";
			EABl√∂cke += "<hr><p>MZO: " + a2EA["MZMO"] + "</p>";
			EABl√∂cke += "<hr><p>EZO: " + a2EA["EZEO"] + "</p>";
			EABl√∂cke += "</div>";

			EABl√∂cke += "<div class='EAEinzelA'><b>Einzelauftr√§ge:</b><br><pre>" + a2EA["Einzelauftr√§ge"] + "</pre></p>";
			EABl√∂cke += "</div>";

			EABl√∂cke += "<p class='EADigi'><svg style='margin-bottom: -26px' width='140px' height='55'>";
			EABl√∂cke += "<text class='digi' x='38' y='25' style='font-weight: bold;'>Digigruppe</text>";
			EABl√∂cke += "<path d='M20,10 h100 l20,20 l-20,20 h-100 l-20,-20 Z' stroke='black' style='fill: none'></path></svg>";
			EABl√∂cke += "<br><span>" + a2EA["EDigi"] + "</span></p>";
		}


//BAO		

		function BAO(BAO_gesamt) { //BAO_gesamt kann die werte true und false haben. Bei true werden alle Eins√§zte angezeigt, bei false nur ein einzelner Einsatz oder Einsatzabschnitte.
            
            //Einsatzanlass nur Darstellen, wenn keine Gesamt√ºbersicht ausgew√§hlt ist. 
            if(!Gesamt√ºbersicht) {
                for (let V_Anlass of EA) {
                    if (V_Anlass.ENr == DsNr) {
                        Text_BAO_Anlass = "<b>Anlass: </b>" + V_Anlass.EAnlass;
                    }
                }
            } else { Text_BAO_Anlass = "<b>*** GESAMT√úBERSICHT ***</b>";}
            
            document.getElementById("BAO_Anlass").innerHTML = Text_BAO_Anlass;//Einsatzanlass in der BAO mit und ohne Inhalt anzeigen. 
			
			var BAOStruktur = "";

			let darstellung = false;

			let korrektX = window.scrollX || window.pageXOffset; // horizontale Scrollposition
			let korrektY = window.scrollY || window.pageYOffset; // vertikale Scrollposition
			let BlID;
			let BAOLinien = "";
	
			if (BAO_gesamt) {

				for (let BAOBlock of EA) {
					if (BAOBlock.dar√ºber == "") BAOStruktur += Blockdarstellung(BAOBlock);  // der erste Block wird nur dargestellt, wenn es keinen EA dar√ºber gibt. Es handelt sich um einen eigenst√§ndigen Einsatz.
				}
			} else {
				for (let BAOBlock of EA) {
					if (BAOBlock.ENr == DsNr) BAOStruktur += Blockdarstellung(BAOBlock);
				}
			}

			document.getElementById("BAOGrafik").innerHTML =  BAOStruktur;

			//Blockmarkierung und selektion
			for (let BlockMark of EA) {
												
				const markierterBlock = document.getElementById("Block" + BlockMark.ENr);

				if (BlockMark.ENr === EA_select) {markierterBlock.style.backgroundColor = Blockfarbe;}//f√§rbt den Block rot nach dem Klick
			
				if (markierterBlock) { //Fehlermeldung vermeiden, wenn der Block nicht existriert
				    markierterBlock.addEventListener('click', function() {
						EA_select = BlockMark.ENr;
						Ansichten_aktualisieren();
					});
				}
			}


			let Durchlauf = 0; // Das erste K√§stchen darf kein Strich oben haben... 

	

			for (let Striche of EA) {

				BlID = "Block" + Striche.ENr;

				let meinDiv = document.getElementById(BlID); //  die aktuellen Koordinaten des Div-Elements zu ermitteln

				

				if (meinDiv) {  //nur wenn der EA existriert wird der folgende Code ausgef√ºhrt

					let rect = meinDiv.getBoundingClientRect(); //|| "kein Objekt"; // DOMRect-Objekt abrufen

					let mitteX = (rect.right - rect.left) / 2 + rect.left;
					let obenP = (mitteX + korrektX ) + "," + (rect.top + korrektY);
					let untenP = (mitteX + korrektX ) + "," + (rect.bottom + korrektY);

					//Linie sektrecht oben:
					++Durchlauf;
					if (Striche.dar√ºber != "" && Durchlauf != 1) {
						BAOLinien += "<path d='M ";
						BAOLinien += obenP;
						BAOLinien += "v -20 ' stroke='black' />";
					}

					//Linie senkrecht unten:
					if (Striche.UANr != "") {
						BAOLinien += "<path d='M ";
						BAOLinien += untenP;
						BAOLinien += "v 20 ' stroke='black' />";

						//Querstrich 
						//von links ...
						let BlID1 = "Block" + Striche.UANr[0];
						let meinDiv1 = document.getElementById(BlID1);
						let rect1 = meinDiv1.getBoundingClientRect();
						let X1 = (rect1.right - rect1.left) / 2 + rect1.left;
						let Y1 = rect1.top;

						//nach recht
						let BlID2 = "Block" + Striche.UANr[Striche.UANr.length - 1];
						let meinDiv2 = document.getElementById(BlID2);
						let rect2 = meinDiv2.getBoundingClientRect();
						let X2 = (rect2.right - rect2.left) / 2 + rect2.left;

						BAOLinien += "<line x1='"; //Querstrich zeichnen
						BAOLinien += X1 + korrektX;
						BAOLinien += "' y1='";
						BAOLinien += Y1 - 20 + korrektY;
						BAOLinien += "' x2='";
						BAOLinien += X2 + korrektX;
						BAOLinien += "' y2='";
						BAOLinien += Y1 - 20 + korrektY;
						BAOLinien += "' stroke='black'/>";
					}
				}
			}

			document.getElementById("Linien").innerHTML = BAOLinien;

			//BAO - Blockaktionen	
			for (let BlockKlickObj of EA) {
				let KlickBlock = "Block" + BlockKlickObj.ENr;
				let DownBlock = "EAB√ú" + BlockKlickObj.ENr;
				let BlockKlick = document.getElementById(KlickBlock);
				let BlockDown = document.getElementById(DownBlock);

				if (BlockKlick) {

					//Verschieben
					if (BAO_gesamt) { //nur verschiebar wenn es sich nicht um einen EA oder UA handelt
						BlockDown.addEventListener('mousedown', function () { verschieben(BlockKlickObj); }, false)
					}
				}
			}
		}


		function Blockdarstellung(Block,Nr) {

			let BAOStruktur2 = "";
			BAOStruktur2 += "<div class='Block'>";
			BAOStruktur2 += "<div id='Block" + Block.ENr + "' class='Kasten'>";
			BAOStruktur2 += "<p id='EAB√ú" + Block.ENr + "' class='EABlock√úberschrift'>" + Block.EBezeichnung + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>ENr: " + Block.ENr + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EDatum: " + Block.EDatum + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>UANr: " + Block.UANr + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EDst: " + Block.EDst + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>EF√ºhrer: " + Block.EF√ºhrer + "</p>";
			BAOStruktur2 += "<p class='EABlockInhalt'>Kr√§fte: " + Block.Kr√§fte + "<br></p>";
			BAOStruktur2 += "</div>";			// Kasten schlie√üen

			//BAOStruktur2 += BAOKontextmenu(Block.ENr);

            let UBlockindex = -1;
            
			for (let UnterBl√∂cke of Block.UANr) {
			    UBlockindex = UBlockindex + 1;
				let UnterBlock = EA.find(elem => elem.ENr === UnterBl√∂cke);
				BAOStruktur2 += Blockdarstellung(UnterBlock, UBlockindex);
			}

			BAOStruktur2 += "</div>";	//Block schlie√üen

			return BAOStruktur2;
		}


//BAO - Funktionen zum Verschieben von EA

		function verschieben(DoppelklickObj) { //Bock mit der Maus bewegen

			let BlockPosName = "Block" + DoppelklickObj.ENr;
			let BlockPosID = document.getElementById(BlockPosName);
			let BlockPosKo = BlockPosID.getBoundingClientRect();
			let DivMove = document.createElement('div');
			let DivMoveStyle = 'z-index: 2000; position: absolute; background: rgba(100, 100, 100, 0.5);';

			DivMoveStyle += 'width: ' + BlockPosKo.width + 'px;';
			DivMoveStyle += 'height: ' + BlockPosKo.height + 'px;';
			DivMoveStyle += 'left: ' + (BlockPosKo.left + window.scrollX) + 'px;';
			DivMoveStyle += 'top: ' + (BlockPosKo.top + window.scrollY) + 'px;';

			DivMove.setAttribute('style', DivMoveStyle);
			DivMove.setAttribute('id', 'MoveBlock');

			document.body.appendChild(DivMove);

			//Papierkorb nur anzeigen, wenn das Objekt gel√∂scht werden kann. Es darf nicht das letzte oberste Objekt sein.
			let PapierkorbAnzeigen = true;
			if (!DoppelklickObj.dar√ºber) {

				let AnzahlEAdar√ºber = 0

				for (let EAD of EA) {
					if (!EAD.dar√ºber) AnzahlEAdar√ºber++;
				}

				if (AnzahlEAdar√ºber == 1) PapierkorbAnzeigen = false;
			}

			DivMove.addEventListener('mousemove', function (e) {
				DivMove.style.left = e.clientX - DivMove.clientWidth / 2 + window.scrollX + 'px';
				DivMove.style.top = e.clientY - DivMove.clientHeight / 2 + window.scrollY + 'px';
			}, false);

			DivMove.addEventListener('mouseup', function () { MausAuf(DoppelklickObj.ENr) }, false);

		}


		function MausAuf(Start) {

			let DivMoveEnde = document.getElementById("MoveBlock");
			let PosX = DivMoveEnde.getBoundingClientRect().left + DivMoveEnde.clientWidth / 2 + window.scrollX;
			let PosY = DivMoveEnde.getBoundingClientRect().top + DivMoveEnde.clientHeight / 2 + window.scrollY;
			DivMoveEnde.remove(); //nachdem die Position bestimmt war, wird das Element gel√∂scht

			//Auf einem anderen Block abgelegt?
			for (let PosEA of EA) {

				if (AufElementAbgelegt(PosX, PosY, "Block" + PosEA.ENr)) {

					let Ziel = PosEA.ENr;

					let Zul√§ssigVerschoben = EAaufUA(Start, Ziel);

					if (Zul√§ssigVerschoben) {

						let verschiebeDS = EA[IndexENr(Start)];
						let dar√ºberDSalt = EA[IndexENr(verschiebeDS.dar√ºber)];
						let dar√ºberDSneu = EA[IndexENr(Ziel)];

						//alte UANr. Bezug l√∂schen
						if (dar√ºberDSalt) {
							for (let i = 0; i < dar√ºberDSalt.UANr.length; i++) {
								if (dar√ºberDSalt.UANr[i] === Start) dar√ºberDSalt.UANr.splice(i, 1);
							}
						}

						//neue UANr. Bezug setzen
						dar√ºberDSneu.UANr.push(Start);

						//neue "dar√ºber" ersetzen
						verschiebeDS.dar√ºber = Ziel;

						Ansichten_aktualisieren()
					}
				}
			}
		}


		function EAaufUA(Start, Ziel) {
			if (Start == Ziel) { return false; }
			if (Ziel == EA[IndexENr(Start)].dar√ºber) { return false; }
			return EAaufUA2(Start, Ziel);
		}


		function EAaufUA2(Start, Ziel) {
			for (let P2 of EA[IndexENr(Start)].UANr) {
				if (P2 == Ziel) { return false; }
				if (!EAaufUA2(P2, Ziel)) { return false; }
			}
			return true;
		}

	
		function AufElementAbgelegt(PosX, PosY, Element) {
			let PosObj = document.getElementById(Element);
			let BlockTop = PosObj.getBoundingClientRect().top + window.scrollY;
			let BlockBottom = PosObj.getBoundingClientRect().bottom + window.scrollY;
			let BlockLeft = PosObj.getBoundingClientRect().left + window.scrollX;
			let BlockRight = PosObj.getBoundingClientRect().right + window.scrollX;

			if (PosX > BlockLeft && PosX < BlockRight && PosY > BlockTop && PosY < BlockBottom) { return true; }

			return false;
		}



//Editor	
	
		function Editor() {
			
			Editor_√∂ffnen();

			let a3EA = EA.find(elem => elem.ENr === EA_select);

			AktuellEditDsNr = EA_select;

			//Formularfelder f√ºllen
			document.getElementById('KonEANr').innerHTML = a3EA["ENr"];
			document.getElementById('KonUANr').innerHTML = a3EA["UANr"];
			//document.getElementById('KonDar√ºber').innerHTML = a3EA["dar√ºber"];
			document.getElementById('EDst').value = a3EA["EDst"];
			document.getElementById('EiDatum').value = a3EA.EDatum;
			document.getElementById('EBezeichnung').value = a3EA["EBezeichnung"];
			document.getElementById('FeldEAnlass').innerHTML = "<textarea id='EAnlass'>" + a3EA["EAnlass"] + "</textarea>";
			document.getElementById('EF√ºhrer').value = a3EA["EF√ºhrer"];
			document.getElementById('EFTelefon').value = a3EA["EFTelefon"];
			document.getElementById('EFRufname').value = a3EA["EFRufname"];
			document.getElementById('EDigi').value = a3EA["EDigi"];
			document.getElementById('LF√ºGr').value = a3EA["LF√ºGr"];
			document.getElementById('F√ºGrTelefon').value = a3EA["F√ºGrTelefon"];
			document.getElementById('F√ºGrRufname').value = a3EA["F√ºGrRufname"];
			document.getElementById('FeldF√ºGrKr√§fte').innerHTML = "<textarea id='F√ºGrKr√§fte'>" + a3EA["F√ºGrKr√§fte"] + "</textarea>";
			document.getElementById('FeldKr√§fte').innerHTML = "<textarea id='Kr√§fte'>" + a3EA["Kr√§fte"] + "</textarea>";
			document.getElementById('MZMO').value = a3EA["MZMO"];
			document.getElementById('EZEO').value = a3EA["EZEO"];
			document.getElementById('FeldFEM').innerHTML = "<textarea id='FEM'>" +  a3EA["FEM"] + "</textarea>";
			document.getElementById('FeldEinzelauftr√§ge').innerHTML = "<textarea id='Einzelauftr√§ge'>" + a3EA["Einzelauftr√§ge"] + "</textarea>";
			document.getElementById('FeldUASMH').innerHTML = "<textarea id='UASMH'>" + a3EA['SMH'] + "</textarea>";
		}


		function Schlie√üen() { //Schie√üen den Editorfensters
					document.getElementById("Formular").style.visibility = "hidden";
					document.getElementById("Toolbox").style.display = "block";
					Ansichten_aktualisieren();
				}

		
		function ESpeichern() {//Formulardatein in das Array √ºbertragen

			let a4EA = EA.find(elem => elem.ENr === AktuellEditDsNr);

			//Daten auf das Array √ºbertragen
			a4EA["EDst"] = document.getElementById('EDst').value;
			a4EA["EBezeichnung"] = document.getElementById('EBezeichnung').value;
			a4EA["EDatum"] = document.getElementById('EiDatum').value;
			a4EA["EAnlass"] = document.getElementById('EAnlass').value;
			a4EA["EF√ºhrer"] = document.getElementById('EF√ºhrer').value;
			a4EA["EFTelefon"] = document.getElementById('EFTelefon').value;
			a4EA["EFRufname"] = document.getElementById('EFRufname').value;
			a4EA["EDigi"] = document.getElementById('EDigi').value;
			a4EA["LF√ºGr"] = document.getElementById('LF√ºGr').value;
			a4EA["F√ºGrRufname"] = document.getElementById('F√ºGrRufname').value;
			a4EA["F√ºGrTelefon"] = document.getElementById('F√ºGrTelefon').value;
			a4EA["F√ºGrKr√§fte"] = document.getElementById('F√ºGrKr√§fte').value;
			a4EA["Kr√§fte"] = document.getElementById('Kr√§fte').value;
			a4EA["MZMO"] = document.getElementById('MZMO').value;
			a4EA["EZEO"] = document.getElementById('EZEO').value;
			//a4EA["FEM"] = document.getElementById('FEM').value;
			a4EA["Einzelauftr√§ge"] = document.getElementById('Einzelauftr√§ge').value;
			a4EA["SMH"] = document.getElementById('UASMH').value;

			document.getElementById("Formular").style.visibility = "hidden";
			document.getElementById("Toolbox").style.display = "block";
			Ansichten_aktualisieren();
}



//Ansichten √§ndern
		
		function Ansichten_aktualisieren() {
						
				BAO(Gesamt√ºbersicht);
				Einsatzkopf();
				Einsatzabschnitte();
		
		}

		
		function BAO_GB() {
			let GB_offen = document.getElementById("Seite").style.visibility;
			let BAO_offen = document.getElementById("BAOFenster").style.visibility;

			if (GB_offen == "visible") {BAO_√∂ffnen();}
			if (BAO_offen == "visible") {GB_√∂ffnen();}

		}


		function √úbersicht() {
			Gesamt√ºbersicht = true;
			Ansichten_aktualisieren();
			BAO_√∂ffnen();
		}


		function GB_√∂ffnen2() {
            DsNr = EA_select;
            Ansichten_aktualisieren();
            GB_√∂ffnen();
        }
        
        
		function GB_√∂ffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "visible";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";
			
			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = false;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("√úbersicht").disabled = false;
			document.getElementById("AA").disabled = false;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = false;
			document.getElementById("GB2").disabled = false;
			document.getElementById("Stift").disabled = false;
			document.getElementById("addEA").disabled = false;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = false;
			document.getElementById("l√∂schen").disabled = false;
			document.getElementById("links").disabled = false;
			document.getElementById("rechts").disabled = false;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = false;
			
			if (DsNr == EA_select) {
				document.getElementById("entlassen").disabled = true;
				document.getElementById("l√∂schen").disabled = true;
				document.getElementById("links").disabled = true;
				document.getElementById("rechts").disabled = true;
			}
		}


		function BAO_√∂ffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "visible";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";
			
			document.getElementById("NEU").disabled = false;
			document.getElementById("Speichern").disabled = false;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("√úbersicht").disabled = false;
			document.getElementById("AA").disabled = false;
			document.getElementById("BAO2").disabled = false;
			document.getElementById("GB2").disabled = false;
			document.getElementById("Stift").disabled = false;
			document.getElementById("addEA").disabled = false;
			document.getElementById("addEinsatz").disabled = false;
			document.getElementById("entlassen").disabled = false;
			document.getElementById("l√∂schen").disabled = false;
			document.getElementById("links").disabled = false;
			document.getElementById("rechts").disabled = false;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = false;
			
			if (Gesamt√ºbersicht) {
				document.getElementById("Export").disabled = false;
				document.getElementById("Importieren").disabled = false;
				document.getElementById("addEinsatz").disabled = false; 
				document.getElementById("√úbersicht").disabled = true;
				document.getElementById("BAO_GB").disabled = true;
			} else {
				document.getElementById("Export").disabled = true;
				document.getElementById("Importieren").disabled = true;
				document.getElementById("addEinsatz").disabled = true; 
				document.getElementById("√úbersicht").disabled = false;
				document.getElementById("BAO_GB").disabled = false;
			}

			if (DsNr_ist_Einsatz) {
				document.getElementById("Hoch").disabled = true;
				document.getElementById("links").disabled = true;
				document.getElementById("rechts").disabled = true;
			} else {
				document.getElementById("Hoch").disabled = false
				document.getElementById("links").disabled = false;
				document.getElementById("rechts").disabled = false;
			}

			Pr√ºfung_Einsatz();
			
		}

		
		function BAO_√∂ffnen2() {
            DsNr = EA_select;
            Gesamt√ºbersicht = false;
            Ansichten_aktualisieren();
            BAO_√∂ffnen();
        }


		function Editor_√∂ffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "visible";
			document.getElementById("Toolbox").style.display = "none";
		}
		

		function Import() {
			document.getElementById("Import").style.visibility = "visible";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "hidden";
			document.getElementById("Formular").style.visibility = "hidden";

			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = true;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("√úbersicht").disabled = true;
			document.getElementById("AA").disabled = true;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = true;
			document.getElementById("GB2").disabled = true;
			document.getElementById("Stift").disabled = true;
			document.getElementById("addEA").disabled = true;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = true;
			document.getElementById("l√∂schen").disabled = true;
			document.getElementById("links").disabled = true;
			document.getElementById("rechts").disabled = true;
			document.getElementById("InfoBoxButton").disabled = false;
			document.getElementById("DruckButton").disabled = true;
		}

		
		function InfoBox_√∂ffnen() {
			document.getElementById("Import").style.visibility = "hidden";
			document.getElementById("Seite").style.visibility = "hidden";
			document.getElementById("BAOFenster").style.visibility = "hidden";
			document.getElementById("InfoBox").style.visibility = "visible";
			document.getElementById("Formular").style.visibility = "hidden";

			document.getElementById("NEU").disabled = true;
			document.getElementById("Speichern").disabled = true;
			document.getElementById("Export").disabled = true;
			document.getElementById("Importieren").disabled = true;
			document.getElementById("√úbersicht").disabled = true;
			document.getElementById("AA").disabled = true;
			document.getElementById("BAO_GB").disabled = false;
			document.getElementById("BAO2").disabled = true;
			document.getElementById("GB2").disabled = true;
			document.getElementById("Stift").disabled = true;
			document.getElementById("addEA").disabled = true;
			document.getElementById("addEinsatz").disabled = true;
			document.getElementById("entlassen").disabled = true;
			document.getElementById("l√∂schen").disabled = true;
			document.getElementById("links").disabled = true;
			document.getElementById("rechts").disabled = true;
			document.getElementById("InfoBoxButton").disabled = true;
			document.getElementById("DruckButton").disabled = false;
		}

		
		function UA√∂ffnen(Aufklappen) {
			DsNr = Aufklappen;
			Ansichten_aktualisieren();
		}

		
		function drucken() {
			document.getElementById("Toolbox").style.display = "none";
			document.getElementById("Linien").style.left = "0px";
			Ansichten_aktualisieren();
			window.print();
			document.getElementById("Toolbox").style.display = "flex";
			document.getElementById("Linien").style.left = "-200px";
			Ansichten_aktualisieren();
		}

		
		function Pr√ºfung_Einsatz() {
			let DS = EA.find(elem => elem.ENr === EA_select); //DS="Datensatz"
			if (!DS.dar√ºber) {
			   
			    DsNr = EA_select;
			    document.getElementById("links").disabled = true;
			    document.getElementById("rechts").disabled = true;
			    document.getElementById("entlassen").disabled = true;
			  
			    }
            else {
               document.getElementById("links").disabled = false;
			   document.getElementById("rechts").disabled = false;
			   document.getElementById("entlassen").disabled = false;
			
            }
		}

		
//Datenfunktionen - Speichern - Laden - Verarbeiten

		function Zeitstempel() {
			let Zeitwert = new Date().toISOString().slice(2, 19);
			Zeitwert = Zeitwert.slice(0, 8) + "_" + Zeitwert.slice(9, 11) + Zeitwert.slice(12, 14) + Zeitwert.slice(15, 17);
			return Zeitwert;
		}


		function exportjson() {

			let filename = Zeitstempel() + " - Einsatzabschnitt";
			let text = EA;
			let element = document.createElement('a');
			element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(EA)));
			element.setAttribute('download', filename + ".BAO");

			element.style.display = 'none';
			document.body.appendChild(element);

			element.click();

			document.body.removeChild(element);
		}


		function IndexENr(WertENr) { //die Funktion ermittelt den Index zur ENr (DatensatzID)
			for (let i = 0; i < EA.length; i++) {
				if (EA[i].ENr == WertENr) { return i; }
			}
		}


		function speichernhtml() {

            // Array in JSON umwandeln
            var EA_AlsJSON = JSON.stringify(EA);
            
            // JSON in HTML speichern (als Beispiel im body-Element)
            document.body.setAttribute('EA-DATA', EA_AlsJSON);
            
            // Den gesamten HTML-Code der Seite erfassen
            var htmlCode = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
            
            // Erstellen eines Blob-Objekts mit dem HTML-Code
            var blob = new Blob([htmlCode], { type: "text/html" });
            
            // Erstellen eines Download-Links
            var a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = Zeitstempel() + " - Grafischer Befehl.html";
            
            // Hinzuf√ºgen des Links zum DOM und Ausl√∂sen des Klicks
            document.body.appendChild(a);
            a.click();
            
            // Entfernen des Links aus dem DOM
            document.body.removeChild(a);
        }

		function importJSON() {
			// Dateiinput-Element ausw√§hlen
			var fileInput = document.getElementById('fileInput');

			// Sicherstellen, dass eine Datei ausgew√§hlt wurde
			if (!fileInput.files.length) {
				alert('Bitte w√§hlen Sie eine Datei aus.');
				return;
			}

			// FileReader erstellen
			var reader = new FileReader();

			// Event-Handler f√ºr das Laden der Datei
			reader.onload = function (e) {
				try {
					// JSON-Parsing
					var ImportierteEA = JSON.parse(e.target.result);

				} catch (error) {
	
					alert("Es ist ein Fehler aufgetreten! Die Datei wurde nicht importiert!");
					return;
				}

				let groessteEANr = Math.max(...EA.map(obj => obj.ENr));

				ImportierteEA.forEach((ImportierterDatensatz) => {

					ImportierterDatensatz.ENr = ImportierterDatensatz.ENr + groessteEANr;

					ImportierterDatensatz.UANr.forEach((ImportUANr, i) => {
						ImportUANr = ImportUANr + groessteEANr;
						ImportierterDatensatz.UANr[i] = ImportUANr;
					});

					if (ImportierterDatensatz.dar√ºber) ImportierterDatensatz.dar√ºber = ImportierterDatensatz.dar√ºber + groessteEANr;

					EA.push(ImportierterDatensatz);
				});

				Ansichten_aktualisieren();

			};

			//Datei lesen
			reader.readAsText(fileInput.files[0]);
			document.getElementById("Import").style.visibility = "hidden";
		}


//EA verschieben oder ver√§ndern

		function shiftLeft() { //Berechnungsfunktion, um die Einsatzabschnitte nach links zu verschieben
			
			let ShiftEA = EA.find(elem => elem.ENr === EA_select);
			let ShiftEAoben = EA.find(elem => elem.ENr === ShiftEA.dar√ºber);
			const index = ShiftEAoben.UANr.indexOf(EA_select);
		    if (index > 0 && index < ShiftEAoben.UANr.length) {
		        const element = ShiftEAoben.UANr.splice(index, 1)[0];  	// Entferne das Element an der gegebenen Position
		        ShiftEAoben.UANr.splice(index - 1, 0, element);			// F√ºge es vor dem Element an der Position (index - 1) ein
			    }
			Ansichten_aktualisieren();
	    }


		function shiftRight() { //Berechnungsfunktion, um die Einsatzabschnitte nach rechts zu verschieben	

            let ShiftEA = EA.find(elem => elem.ENr === EA_select);
			let ShiftEAoben = EA.find(elem => elem.ENr === ShiftEA.dar√ºber);
        	const index = ShiftEAoben.UANr.indexOf(EA_select);
			if (index >= 0 && index < ShiftEAoben.UANr.length - 1) {
				const element = ShiftEAoben.UANr.splice(index, 1)[0];		// Entferne das Element an der gegebenen Position
				ShiftEAoben.UANr.splice(index + 1, 0, element); 			// F√ºge es am Ende des Arrays ein
			}

			Ansichten_aktualisieren();
		}


		function EA_entlassen(EA_Nr) {

			let Best√§tigung = confirm("Soll der EA wirklich aus dem Einsatz enlassen bzw. aus dieser BAO ausgeglieder werden? Sollten unterstellten UA vorhanden sein, bleiben diese in ihrem bestehenden Unterstellungsverh√§ltnis. Der EA wird in der Gesamt-BAO als eigener Einsatz angezeigt. Umgliederungen k√∂nnen in der Gesamt-BAO-Ansicht ge√§ndert werden. ");
			if (Best√§tigung) { EA_entlassen2(EA_Nr); }
		}


		function EA_entlassen2(EA_Nr) {

			let a7EA = EA.find(elem => elem.ENr === EA_Nr);
			let a8EA = EA.find(elem => elem.ENr === a7EA.dar√ºber);
			a7EA.dar√ºber = "";
			let x = 0;

			for (let LUA of a8EA.UANr) {
				if (EA_Nr == LUA) { a8EA.UANr.splice(x, 1); }
				x++;
			}

			Ansichten_aktualisieren();
		}


		function neuerEA()
		{

			let nENr = Math.max(...EA.map(obj => obj.ENr)) + 1;

			if (nENr == "-Infinity") nENr = 1;

			let neueNr = EA.length;

			EA[neueNr] = new Object();
			EA[neueNr]["ENr"] = nENr;
			EA[neueNr]["UANr"] = [];
			EA[neueNr]["dar√ºber"] = EA_select; // hier wird der Datensatz dar√ºber festgelegt.
			EA[neueNr]["EBezeichnung"] = "EA " + (nENr-1);
			EA[neueNr]["EDatum"] = "n.n.";
			EA[neueNr]["EAnlass"] = "n.n.";
			EA[neueNr]["EF√ºhrer"] = "n.n.";
			EA[neueNr]["EDst"] = "n.n.";
			EA[neueNr]["EFTelefon"] = "n.n.";
			EA[neueNr]["EFRufname"] = "n.n.";
			EA[neueNr]["EDigi"] = "n.n.";
			EA[neueNr]["LF√ºGr"] = "n.n.";
			EA[neueNr]["F√ºGrRufname"] = "n.n.";
			EA[neueNr]["F√ºGrTelefon"] = "n.n.";
			EA[neueNr]["F√ºGrKr√§fte"] = "n.n.";
			EA[neueNr]["Kr√§fte"] = "n.n.";
			EA[neueNr]["MZMO"] = "n.n.";
			EA[neueNr]["EZEO"] = "n.n.";
			EA[neueNr]["FEM"] = "n.n.";
			EA[neueNr]["Einzelauftr√§ge"] = "n.n.";
			EA[neueNr]["SMH"] = "n.n.";

			if (EA_select) { 
			    let a5EA = EA.find(elem => elem.ENr === EA_select);
			    a5EA["UANr"].push(nENr); // bei UANr. die aktuelle EA-Nr angeh√§ngen
			} else {
			EA_select = nENr;
			EA[neueNr]["EBezeichnung"] = "PF " + (nENr-1);
			
			}
			
		}


		function EA_l√∂schen() {

			let Best√§tigung = confirm("Soll der EA wirklich gel√∂scht werden? Die unterstellten UA werden ebenfalls gel√∂scht und k√∂nnen nicht wiederhergestellt werden. ");
			
			if (Best√§tigung) {
				
				for (let DS of EA) {
				    if (DS.ENr = EA_select) {let EA_select_neu = DS.dar√ºber;}
				}
				
				console.log("EA_select: " + EA_select)
				
				EA_l√∂schen2(EA_select);
				
				EA_select = EA_select_neu;
				
				Ansichten_aktualisieren();
			}
		}


		function EA_l√∂schen2(EntferneEA) {
		    
		        console.log("EntferneEA :" +  EntferneEA);
		        
				let IndexL√∂schen = IndexENr(EntferneEA);
				
				if (EA[IndexL√∂schen].dar√ºber) EA_entlassen2(EntferneEA); // Verbindung dar√ºber l√∂schen
				
				EA_l√∂schen3(EntferneEA); // erst dann die Eins√§tze nacheinander l√∂schen
		}


		function EA_l√∂schen3(EntferneEA) {
		    
				let IndexL√∂schen = IndexENr(EntferneEA);
				
				for (let EAL of EA[IndexL√∂schen].UANr) EA_l√∂schen3(EAL); // erst eventuell vorhandene UA l√∂schen

				// EA l√∂schen
				let nDsNr = false;

				if (EA[IndexL√∂schen].ENr == DsNr) {nDsNr = true;} //wenn der fokussierte Datensatz gel√∂scht wird, muss ein neuer Datensatz festgelegt werden. 
				EA.splice(IndexL√∂schen, 1);

				if (nDsNr) {
					for (let neuerDsNr of EA) {
						if (!neuerDsNr.dar√ºber) DsNr = neuerDsNr.ENr; // der erste Datensatz, der ohne "dar√ºber" gefunden wird, bekommt den Focus!
					}
				}
		}			

		function EAplus() {
                neuerEA();  
			    Ansichten_aktualisieren();
		}


		function BAOplus() {
		    
		        EA_select = "";
				neuerEA();
				
				Ansichten_aktualisieren();
		}


		function neu() {
				let Best√§tigung = confirm("ACHTUNG! Es werden alle Daten gel√∂scht, die Datei aber nicht √ºberschrieben. Sie k√∂nnen die Datei anschlie√üend unter einem anderen Namen speichern! Soll eine neue BAO/ein neuer Grafischer Befehl angelegt werden?");
				if (Best√§tigung) {
					EA = []; // alle Daten l√∂schern
					EA_select="";
					neuerEA();
					EA_select = 1;
					DsNr = EA[0].ENr;
					EA[0].dar√ºber = "";
					EA[0].EBezeichnung = "PF 1"; 
					neuerEA(EA[0].ENr);
					neuerEA(EA[0].ENr);
					neuerEA(EA[0].ENr);
            
                    EA_select = 1;

					Ansichten_aktualisieren();
	            }
		}


		function H√∂her_Stufen() { //setzt den Fokus auf den dar√ºberliegenden EA
		    let DS = EA.find(elem => elem.ENr === DsNr); //DS="Datensatz"
	    	if (DS.dar√ºber) { DsNr = DS.dar√ºber; }

	    	Ansichten_aktualisieren();
	    	
        }
        
        function EA_l√∂schen_StufeA() { //Pr√ºfung ob EA.dar√ºber vorhanden ist. Wenn ja, dann dort Bezug trennen
             
            let Best√§tigung = confirm("Soll der EA wirklich gel√∂scht werden? Die eventuell vorhandenen unterstellte UA werden ebenfalls gel√∂scht und k√∂nnen nicht wiederhergestellt werden. ");
            
            if (Best√§tigung) {
               	
               	let DS = EA.find (elem => elem.ENr === EA_select);
             	
             	if (DS.dar√ºber) { //ja, ist vorhanden, dann...
				    let DS1 = EA.find (elem => elem.ENr === DS.dar√ºber);
                    for (let i = 0; i < DS1.UANr.length; i++) { //Index feststellung
					        if (DS1.UANr[i] == EA_select) {
			                DS1.UANr.splice(i, 1); //UANr herausl√∂schen
         			        }
		            }
		         } 
		        
		        EA_l√∂schen_StufeB(EA_select);
		        
		        Ansichten_aktualisieren();
            }
        }
        
        
        function EA_l√∂schen_StufeB(DS_l√∂schen) { //pr√ºfen ob weitere UA vorhanden sind, dann diese zuerst l√∂schen 

                let DS = EA.find (elem => elem.ENr === DS_l√∂schen);
                
                if (DS.UANr) { //sind vorhanden, sind dann auch zuerst zu l√∂schen
                    for (let UA_DS of DS.UANr) {
                        EA_l√∂schen_StufeB(UA_DS);
                    }
                }
                
                if (EA.length == 1) { //
                    alert("Der letzte Datensatz kann nicht gel√∂scht werden. Sie k√∂nnen ggf. eine neue Dattei anlegen.");
                    Ansichten_aktualisieren();
                    return;
                }
                
                if (DS.dar√ºber) { //neuen Focus festlegen
                   EA_select = DS.dar√ºber; 
                } else {
             
                    for (let DS1 of EA) {
                        if (!DS1.dar√ºber) {
                            if (DS_l√∂schen != DS1.ENr) {
                                EA_select = DS1.ENr;
                                break;
                            } 
                        } 
                    }
                }
 
                for (let i = 0; i < EA.length; i++) { //Datensatz l√∂schen
				        if (EA[i].ENr == DS_l√∂schen) {
				            EA.splice(i, 1); //EA l√∂schen
				        }
		        }
		        
		        
                if (DS_l√∂schen == DsNr) { //DsNr neu vergeben wenn ben√∂tigt
                    for (let DS2 of EA) {
                        if (!DS2.dar√ºber) {
                            DsNr = DS2.ENr;
                            EA_select = DS2.ENr;
                            break;
                        }                        
                    }
                }
		        
		            
        }


	</script>


</body></html>